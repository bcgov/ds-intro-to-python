<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Stuart Hemerling">

<title>Introduction to Data Science using Python - 2&nbsp; Exploring Data Structures</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./00_introduction_to_python.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploring Data Structures</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Data Science using Python</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_introduction_to_python.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31_exploring_data_structures.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploring Data Structures</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#exploring-and-understanding-data" id="toc-exploring-and-understanding-data" class="nav-link active" data-scroll-target="#exploring-and-understanding-data"><span class="toc-section-number">3</span>  Exploring and Understanding Data</a>
  <ul>
  <li><a href="#selecting-columns-variables" id="toc-selecting-columns-variables" class="nav-link" data-scroll-target="#selecting-columns-variables"><span class="toc-section-number">3.1</span>  Selecting columns (variables)</a></li>
  <li><a href="#selecting-rows" id="toc-selecting-rows" class="nav-link" data-scroll-target="#selecting-rows"><span class="toc-section-number">3.2</span>  Selecting rows</a></li>
  <li><a href="#sorting-rows" id="toc-sorting-rows" class="nav-link" data-scroll-target="#sorting-rows"><span class="toc-section-number">3.3</span>  Sorting rows</a></li>
  <li><a href="#putting-multiple-methods-together-chaining" id="toc-putting-multiple-methods-together-chaining" class="nav-link" data-scroll-target="#putting-multiple-methods-together-chaining"><span class="toc-section-number">3.4</span>  Putting multiple methods together (chaining)</a></li>
  <li><a href="#creating-new-columns-of-data" id="toc-creating-new-columns-of-data" class="nav-link" data-scroll-target="#creating-new-columns-of-data"><span class="toc-section-number">3.5</span>  Creating new columns of data</a></li>
  <li><a href="#joining-datasets-together" id="toc-joining-datasets-together" class="nav-link" data-scroll-target="#joining-datasets-together"><span class="toc-section-number">3.6</span>  Joining datasets together</a></li>
  <li><a href="#grouping-and-summarizing" id="toc-grouping-and-summarizing" class="nav-link" data-scroll-target="#grouping-and-summarizing"><span class="toc-section-number">3.7</span>  Grouping and summarizing</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Exploring Data Structures</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Stuart Hemerling </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="exploring-and-understanding-data" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Exploring and Understanding Data</h1>
<p>Getting a high level summary of the data is important but data is particularly valuable when refined. Your analysis will start to come alive when we start to do some slicing and dicing and grouping of data or even creating additional variables. In an Excel world, this is like when you use filter options for columns, or create pivot tables, or when you create a formula in a new column to create a new variable. In data science parlance, this is the kind of thing that is referred to as <code>data wrangling</code> - getting the (already cleaned) data you want in the form you want it in.</p>
<p>In the world of python, this usually means working with a library or package you have already been introduced to called pandas. It let’s you do so much!</p>
<p>The first dataset we’ll look at is one that looks at data for countries around the world and shows population levels as well as gdp per capita over a number of years. It is a great data set to look at. Let’s import the pandas library and then use the <code>.read_csv()</code> function to get some population by country data.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/bcgov/ds-intro-to-python/main/data/gapfinder.csv"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_csv(url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It’s usually a good idea right away to take a quick look at the data to make sure what we have read in makes sense. The <code>.info()</code> method prints the number of columns, column labels, column data types, memory usage, range index, and the number of cells in each column (non-null values).</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Reminder: Naming variables!
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you create a variable or object, you can name it pretty much whatever you want. You will see widespread use of the name “df”. Apart from “df”, it is considered good practice to name dataframes something that is at the same time intuitive but not overly verbose. Also remember to not leave spaces in your names, and to always be consistent in the naming conventions you use (e.g.&nbsp;camelCase, underscore_case, etc.)</p>
</div>
</div>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 1704 entries, 0 to 1703
Data columns (total 6 columns):
 #   Column     Non-Null Count  Dtype  
---  ------     --------------  -----  
 0   country    1704 non-null   object 
 1   year       1704 non-null   int64  
 2   pop        1704 non-null   float64
 3   continent  1704 non-null   object 
 4   lifeExp    1704 non-null   float64
 5   gdpPercap  1704 non-null   float64
dtypes: float64(3), int64(1), object(2)
memory usage: 80.0+ KB</code></pre>
</div>
</div>
<p>So this data is looking good so far. We can see that we have created a pandas dataframe within our python environment. There are 1704 rows of data and six columns or variables. You can see there are only non-null values… so happily there is no missing data to worry about.</p>
<p>The <code>.head()</code> pandas method let’s us look at actual data as one does in Excel.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1952</td>
      <td>8425333.0</td>
      <td>Asia</td>
      <td>28.801</td>
      <td>779.445314</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1957</td>
      <td>9240934.0</td>
      <td>Asia</td>
      <td>30.332</td>
      <td>820.853030</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This dataset has some high level country metrics about population and the economy going back to 1952.</p>
<section id="selecting-columns-variables" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="selecting-columns-variables"><span class="header-section-number">3.1</span> Selecting columns (variables)</h2>
<p>In the “real world” of data it is not uncommon to see hundreds or even thousands of columns in a single dataframe, so knowing how to pare down our dataset so it is not overly bloated is important.</p>
<center>
<img src="images/exploring-data-structures/select_columns.png" width="700" style="margin:auto">
<p style="text-align: center">
Selecting Columns
</p>
<br>
</center>
<p>First things first. If we want to look the contents of a single column, we could do it like this, specifying the column name after the . without parentheses:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.country</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>0       Afghanistan
1       Afghanistan
2       Afghanistan
3       Afghanistan
4       Afghanistan
           ...     
1699       Zimbabwe
1700       Zimbabwe
1701       Zimbabwe
1702       Zimbabwe
1703       Zimbabwe
Name: country, Length: 1704, dtype: object</code></pre>
</div>
</div>
<p>When we want to select more than one column to include in our dataframe, we use the convention df[[‘col1’, ‘col2’]] to select the columns we want.</p>
<p>In our example below, we will create a new dataframe called “narrow_df”, and we are primarily interested in getting the population column from the original df, but we want to have year, country, and continent in our new dataframe also.</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>narrow_df <span class="op">=</span> df[[<span class="st">'country'</span>, <span class="st">'year'</span>, <span class="st">'pop'</span>, <span class="st">'continent'</span>]]</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>narrow_df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1952</td>
      <td>8425333.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1957</td>
      <td>9240934.0</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>So now we have a more manageable dataset to work with called “narrow_df”. The original dataframe “df” is still there, and still the same shape as before, we have not changed it.</p>
<p>Sometimes you might have many columns in a dataframe you want to keep and only a relatively few you might want to remove. In these instances, you might want to use the pandas <code>.drop()</code> method instead. We can achieve the same result as the example above by simply dropping two variables instead of naming the other four. With this method, we also need to add the specification <code>axis = 1</code>, which indicates that it is columns being referenced for being dropped.</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>narrow_df <span class="op">=</span> df.drop([<span class="st">'lifeExp'</span>, <span class="st">'gdpPercap'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>narrow_df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1952</td>
      <td>8425333.0</td>
      <td>Asia</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1957</td>
      <td>9240934.0</td>
      <td>Asia</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Reminder on Assignment!
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you create a variable or dataframe object in python, to the left of the <code>=</code> sign you always put the name of the thing you want to make or modify. To the right, that’s where you put the contents of what it is you want to create. It may feel counterintuitive! Especially if you are using the same variable or dataframe identifier on both sides of the equals sign.</p>
</div>
</div>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Let’s say you just want to narrow down the dataset to include just the country and the GDP per capita. How would you do it? Don’t forget to run your code so it also shows a view of the result so you can confirm the code worked as you wanted it to.</p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution to Challenge 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>First you would like to create a new object to hold this narrowed down version of the dataset, then just use the <code>.head()</code> to see some of the resulting data.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>challenge1_df <span class="op">=</span> df[[<span class="st">'country'</span>, <span class="st">'gdpPercap'</span>]]</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>challenge1_df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="7">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>779.445314</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>820.853030</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="selecting-rows" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="selecting-rows"><span class="header-section-number">3.2</span> Selecting rows</h2>
<p>Of course, in data analysis we are usually interested in looking at just some of rows of data, not all of it all the time.</p>
<center>
<img src="images/exploring-data-structures/select_rows.png" width="700" style="margin:auto">
<p style="text-align: center">
Selecting Rows
</p>
<br>
</center>
<p>So when we want to look at just selected rows (i.e.&nbsp;values within a given column) we can specify the column(s) we want to select from, then we use <code>==</code> or a different operator as we require:</p>
<ul>
<li>not equal to <code>!=</code></li>
<li>less than <code>&lt;</code></li>
<li>greater than <code>&gt;</code></li>
<li>less than or equal to <code>&lt;=</code></li>
<li>greater than or equal to <code>&gt;=</code></li>
</ul>
<p>Note that we do not use the <code>=</code> operator when it comes to specifying values we want to find in a column. This is an important point in python. The <code>==</code> operator compares the value or equality of two objects and is the right operator to use. It is a <code>comparison</code> operator. In comparison, the <code>=</code> is an <code>assignment</code> operator. We use it, for example, when we create or assign variables or objects. In the example below we see both at work.</p>
<p>Likely the most common way in python to select rows is to use a condition inside selection brackets <code>[]</code></p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[df[<span class="st">'year'</span>] <span class="op">==</span> <span class="dv">1972</span>]</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>filtered_df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="8">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>1972</td>
      <td>13079460.0</td>
      <td>Asia</td>
      <td>36.088</td>
      <td>739.981106</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Albania</td>
      <td>1972</td>
      <td>2263554.0</td>
      <td>Europe</td>
      <td>67.690</td>
      <td>3313.422188</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Let’s look at what is happening under the hood. We see that pandas checks each row to see which rows fulfill the condition specified.</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'year'</span>] <span class="op">==</span> <span class="dv">1972</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">
<pre><code>0       False
1       False
2       False
3       False
4        True
        ...  
1699    False
1700    False
1701    False
1702    False
1703    False
Name: year, Length: 1704, dtype: bool</code></pre>
</div>
</div>
<p>We can also expand this concept by adding additional conditions that narrow or expand the number of rows filtered. Below we use the <code>&amp;</code> condition to indicate that both parts of the equation need to be fulfilled.</p>
<p>When combining multiple conditional statements as in the example below, each condition must be surrounded by parentheses <code>()</code> within the square brackets <code>[]</code>. You must use the “or” operator <code>|</code> and/or the “and” operator <code>&amp;</code> for the code to work.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[(df[<span class="st">'year'</span>] <span class="op">==</span> <span class="dv">1972</span>) <span class="op">&amp;</span> (df[<span class="st">'country'</span>] <span class="op">==</span> <span class="st">'Albania'</span>)]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>filtered_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>16</th>
      <td>Albania</td>
      <td>1972</td>
      <td>2263554.0</td>
      <td>Europe</td>
      <td>67.69</td>
      <td>3313.422188</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>In the example above, there is only one row of data that matches the condition.</p>
<p>Or we can use the <code>|</code> which indicates that if <em>either</em> of the statements are true, then all the rows satisfying either condition are returned.</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>filtered_df <span class="op">=</span> df[(df[<span class="st">'year'</span>] <span class="op">==</span> <span class="dv">1972</span>) <span class="op">|</span> (df[<span class="st">'country'</span>] <span class="op">==</span> <span class="st">'Albania'</span>)]</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>filtered_df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>1972</td>
      <td>13079460.0</td>
      <td>Asia</td>
      <td>36.088</td>
      <td>739.981106</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Albania</td>
      <td>1952</td>
      <td>1282697.0</td>
      <td>Europe</td>
      <td>55.230</td>
      <td>1601.056136</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Albania</td>
      <td>1957</td>
      <td>1476505.0</td>
      <td>Europe</td>
      <td>59.280</td>
      <td>1942.284244</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Albania</td>
      <td>1962</td>
      <td>1728137.0</td>
      <td>Europe</td>
      <td>64.820</td>
      <td>2312.888958</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Albania</td>
      <td>1967</td>
      <td>1984060.0</td>
      <td>Europe</td>
      <td>66.220</td>
      <td>2760.196931</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>In the example above, there are many rows that satisfy the condition.</p>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Your director has come to you and asked if you know what the life expectancy has been in Canada since 1992. How would you use pandas code to get the data you need? And after having run the code, what’s the answer?</p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution to Challenge 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>First you would like to create a new object to hold this narrowed down version of the dataset, then use some method like <code>.print()</code> or <code>.head()</code> to see some of the resulting data.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>challenge2_df <span class="op">=</span> df[(df[<span class="st">'year'</span>] <span class="op">&gt;=</span> <span class="dv">1992</span>) <span class="op">&amp;</span> (df[<span class="st">'country'</span>] <span class="op">==</span> <span class="st">'Canada'</span>)]</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(challenge2_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    country  year         pop continent  lifeExp    gdpPercap
248  Canada  1992  28523502.0  Americas   77.950  26342.88426
249  Canada  1997  30305843.0  Americas   78.610  28954.92589
250  Canada  2002  31902268.0  Americas   79.770  33328.96507
251  Canada  2007  33390141.0  Americas   80.653  36319.23501</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>You will find that it is very common within python/pandas to see the <code>.iloc()</code> method.</p>
<p>The <code>.iloc()</code> method identifies rows based on their index value (that column to the left of the dataframe when you call the <code>.head()</code> function, for example). It can be used to look at individual rows of data by their original index value.</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df.iloc[<span class="dv">251</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">
<pre><code>country           Canada
year                2007
pop           33390141.0
continent       Americas
lifeExp           80.653
gdpPercap    36319.23501
Name: 251, dtype: object</code></pre>
</div>
</div>
<p>Or it can be used to call multiple rows in a range:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df.iloc[<span class="dv">0</span>:<span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1952</td>
      <td>8425333.0</td>
      <td>Asia</td>
      <td>28.801</td>
      <td>779.445314</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1957</td>
      <td>9240934.0</td>
      <td>Asia</td>
      <td>30.332</td>
      <td>820.853030</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>1962</td>
      <td>10267083.0</td>
      <td>Asia</td>
      <td>31.997</td>
      <td>853.100710</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>1967</td>
      <td>11537966.0</td>
      <td>Asia</td>
      <td>34.020</td>
      <td>836.197138</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>1972</td>
      <td>13079460.0</td>
      <td>Asia</td>
      <td>36.088</td>
      <td>739.981106</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="sorting-rows" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="sorting-rows"><span class="header-section-number">3.3</span> Sorting rows</h2>
<p>So now you’ve mastered how to select rows and columns you want, congratulations! Instead of hunting and pecking for insights, one way to quickly make some sense of the data is to sort it - something you probably do in Excel all the time.</p>
<p>In the challenge above we created a dataframe “challenge2_df” with just the one country in it and from 1997. So now let’s sort the data by year, and then see what can spot any insights. To do this, we use the <code>.sort_values()</code> method.</p>
<p>Let’s go fetch and look at the dataframe, and use this method to sort by year, going from more recent to less recent:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>challenge2_df.sort_values(<span class="st">'year'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>251</th>
      <td>Canada</td>
      <td>2007</td>
      <td>33390141.0</td>
      <td>Americas</td>
      <td>80.653</td>
      <td>36319.23501</td>
    </tr>
    <tr>
      <th>250</th>
      <td>Canada</td>
      <td>2002</td>
      <td>31902268.0</td>
      <td>Americas</td>
      <td>79.770</td>
      <td>33328.96507</td>
    </tr>
    <tr>
      <th>249</th>
      <td>Canada</td>
      <td>1997</td>
      <td>30305843.0</td>
      <td>Americas</td>
      <td>78.610</td>
      <td>28954.92589</td>
    </tr>
    <tr>
      <th>248</th>
      <td>Canada</td>
      <td>1992</td>
      <td>28523502.0</td>
      <td>Americas</td>
      <td>77.950</td>
      <td>26342.88426</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="putting-multiple-methods-together-chaining" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="putting-multiple-methods-together-chaining"><span class="header-section-number">3.4</span> Putting multiple methods together (chaining)</h2>
<p>You can also put multiple methods in the same line of code, as long as you separate each of the elements. In pandas, this is called “method chaining”, as you are essentially of creating a chain of actions to take place.</p>
<p>In the example below, the chain consists of two links:</p>
<ol type="1">
<li>Select just the rows where the country is equal to Canada AND where the year is 1997 or greater</li>
<li>Take these rows and sort them by year, going from high to low values, top to bottom</li>
</ol>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>chained_df <span class="op">=</span> df[(df[<span class="st">'country'</span>] <span class="op">==</span> <span class="st">'Canada'</span>) <span class="op">&amp;</span> (df[<span class="st">'year'</span>] <span class="op">&gt;=</span> <span class="dv">1997</span>)].sort_values(<span class="st">'year'</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>chained_df.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>251</th>
      <td>Canada</td>
      <td>2007</td>
      <td>33390141.0</td>
      <td>Americas</td>
      <td>80.653</td>
      <td>36319.23501</td>
    </tr>
    <tr>
      <th>250</th>
      <td>Canada</td>
      <td>2002</td>
      <td>31902268.0</td>
      <td>Americas</td>
      <td>79.770</td>
      <td>33328.96507</td>
    </tr>
    <tr>
      <th>249</th>
      <td>Canada</td>
      <td>1997</td>
      <td>30305843.0</td>
      <td>Americas</td>
      <td>78.610</td>
      <td>28954.92589</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Another way of chaining is to put each of the functions on multiple lines. In the example below, each line of code modifies the dataframe to acheive the same result as above.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>chained2_df <span class="op">=</span> df[(df[<span class="st">'country'</span>] <span class="op">==</span> <span class="st">'Canada'</span>)]</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>chained2_df <span class="op">=</span> chained2_df[(chained2_df[<span class="st">'year'</span>] <span class="op">&gt;=</span> <span class="dv">1997</span>)]</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>chained2_df <span class="op">=</span> chained2_df.sort_values(<span class="st">'year'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>chained2_df.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>251</th>
      <td>Canada</td>
      <td>2007</td>
      <td>33390141.0</td>
      <td>Americas</td>
      <td>80.653</td>
      <td>36319.23501</td>
    </tr>
    <tr>
      <th>250</th>
      <td>Canada</td>
      <td>2002</td>
      <td>31902268.0</td>
      <td>Americas</td>
      <td>79.770</td>
      <td>33328.96507</td>
    </tr>
    <tr>
      <th>249</th>
      <td>Canada</td>
      <td>1997</td>
      <td>30305843.0</td>
      <td>Americas</td>
      <td>78.610</td>
      <td>28954.92589</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This latter approach is very common. Each respective line to the right of the <code>=</code> contains the code that modifies the object assigned to the left of it. Note that you can use a combination of chaining and piping.</p>
<p>Each line is executed in sequence, so be careful when constructing code that the order in which you modify your dataframe is right. Take the example below, in which we want to find European values for GDP per capita. In it, we first have a line of code that selects the rows that contain “Europe” in the first line, then looks at the column values for “year”, “country”, and “gdpPercap”.</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>year_country_gdp <span class="op">=</span> df[(df[<span class="st">'continent'</span>] <span class="op">==</span> <span class="st">'Europe'</span>)]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>year_country_gdp <span class="op">=</span> year_country_gdp[[<span class="st">'year'</span>, <span class="st">'country'</span>, <span class="st">'gdpPercap'</span>]]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>year_country_gdp.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>year</th>
      <th>country</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12</th>
      <td>1952</td>
      <td>Albania</td>
      <td>1601.056136</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1957</td>
      <td>Albania</td>
      <td>1942.284244</td>
    </tr>
    <tr>
      <th>14</th>
      <td>1962</td>
      <td>Albania</td>
      <td>2312.888958</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Had we reversed the lines of code, and selected the “year”, “country”, and “gdpPercap” columns first to put into our new object, we would not have been able to sort for “Europe” in the “continent” column, as the “continent” would have been essentially removed from the dataframe in the step above, so python would have thrown an error.</p>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Your director has come back to you and wondered about whether the life expectancy of people changed during the 1970s in Cambodia. Use what you know about selecting rows and sorting data to get the data you need to answer the question.</p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution to Challenge 3
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using code to select the country Cambodia, then call <code>sort_values()</code> method and chain them together. Looking at the data we see that in the 1970s there was a sharp decline in life expectancy in Cambodia. We also see, thankfully, that it has recovered strongly since then.</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>challenge3_df <span class="op">=</span> df[(df[<span class="st">'country'</span>] <span class="op">==</span> <span class="st">'Cambodia'</span>)].sort_values(<span class="st">'year'</span>, ascending <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(challenge3_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      country  year         pop continent  lifeExp    gdpPercap
227  Cambodia  2007  14131858.0      Asia   59.723  1713.778686
226  Cambodia  2002  12926707.0      Asia   56.752   896.226015
225  Cambodia  1997  11782962.0      Asia   56.534   734.285170
224  Cambodia  1992  10150094.0      Asia   55.803   682.303175
223  Cambodia  1987   8371791.0      Asia   53.914   683.895573
222  Cambodia  1982   7272485.0      Asia   50.957   624.475478
221  Cambodia  1977   6978607.0      Asia   31.220   524.972183
220  Cambodia  1972   7450606.0      Asia   40.317   421.624026
219  Cambodia  1967   6960067.0      Asia   45.415   523.432314
218  Cambodia  1962   6083619.0      Asia   43.415   496.913648
217  Cambodia  1957   5322536.0      Asia   41.366   434.038336
216  Cambodia  1952   4693836.0      Asia   39.417   368.469286</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="creating-new-columns-of-data" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="creating-new-columns-of-data"><span class="header-section-number">3.5</span> Creating new columns of data</h2>
<p>Very often we have some data in our dataset that we want to transform to give us additional information. In Excel this is something that is done all the time by creating a formula in a cell that refers to other columns and applies some sort of logic or mathematical expression to it.</p>
<p>There are different ways you can go about this in pandas. The most straightforward way is to define a new column on the left of the <code>=</code> and then reference the existing column and whatever additional conditions you would like on the right. In the example below, the existing population variable “pop” is converted to a value that shows population in millions.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>new_cols_df <span class="op">=</span> df</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>new_cols_df[<span class="st">'pop_millions'</span>] <span class="op">=</span> new_cols_df[<span class="st">'pop'</span>]<span class="op">/</span><span class="dv">1000000</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>new_cols_df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
      <th>pop_millions</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1952</td>
      <td>8425333.0</td>
      <td>Asia</td>
      <td>28.801</td>
      <td>779.445314</td>
      <td>8.425333</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1957</td>
      <td>9240934.0</td>
      <td>Asia</td>
      <td>30.332</td>
      <td>820.853030</td>
      <td>9.240934</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>So now we can see which countries had the biggest GDP in 2007. Notice that the GDP data is in scientific notation (i.e.&nbsp;the decimal number times x number of zeros), so it’s a bit hard to read. If we wanted readers to consume that data we would go ahead and change the data type for it. But for current purposes we’ll leave that alone.</p>
<p>There is a special python function called <code>lambda</code>. It is known as an anonymous function, because it is not given a name other than lambda, and can take any number of arguments in an expression.</p>
<p>The <code>.assign()</code> method looks at this expression with lambda in it and returns the value it is asked to do. This is how it comes all together to give us actual GDP for each row in our dataframe:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>new_df <span class="op">=</span> df.assign(gdp<span class="op">=</span><span class="kw">lambda</span> x: x[<span class="st">'pop'</span>] <span class="op">*</span> x[<span class="st">'gdpPercap'</span>])</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>new_df.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
      <th>pop_millions</th>
      <th>gdp</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1952</td>
      <td>8425333.0</td>
      <td>Asia</td>
      <td>28.801</td>
      <td>779.445314</td>
      <td>8.425333</td>
      <td>6.567086e+09</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1957</td>
      <td>9240934.0</td>
      <td>Asia</td>
      <td>30.332</td>
      <td>820.853030</td>
      <td>9.240934</td>
      <td>7.585449e+09</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>1962</td>
      <td>10267083.0</td>
      <td>Asia</td>
      <td>31.997</td>
      <td>853.100710</td>
      <td>10.267083</td>
      <td>8.758856e+09</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>1967</td>
      <td>11537966.0</td>
      <td>Asia</td>
      <td>34.020</td>
      <td>836.197138</td>
      <td>11.537966</td>
      <td>9.648014e+09</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>1972</td>
      <td>13079460.0</td>
      <td>Asia</td>
      <td>36.088</td>
      <td>739.981106</td>
      <td>13.079460</td>
      <td>9.678553e+09</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Python allows us to create our own custom functions which we can use together with lambda. We won’t create out own function here, but they we can make functions do any number of things, like double a number or convert celcius to fahrenheit, or whatever. Let’s assume that we have created a function and assigned it the name “myfunc”.</p>
<p>We could and add it inline with <code>lambda</code> together with the <code>.apply()</code> function as in this example, which applies the function to a particular column:</p>
<p>df[‘new_col’] = df[‘old_col’]<code>.apply</code>(<code>lambda</code> x: <code>myfunc</code>(x))</p>
<p>Finally, the example below would call, not just one column, but <em>all columns</em> (i.e.&nbsp;axis=1) in a dataframe to produce the new column result:</p>
<p>df[‘new_col’] = df<code>.apply</code>(<code>lambda</code> x: <code>myfunc</code>(x), axis=1)</p>
</section>
<section id="joining-datasets-together" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="joining-datasets-together"><span class="header-section-number">3.6</span> Joining datasets together</h2>
<p>One of the most important tasks in data analysis is to be able to join multiple datasets together. With pandas, there are functions called <code>.merge()</code> and <code>.join()</code> that are similar to each other. As <code>.merge()</code> is perhaps the more used, intuitive, and powerful of the two, we will introduce that method in this tutorial in some depth. There is also a cool function called <code>.concat()</code> that will be introduced below as well.</p>
<p>But first, let’s get a second file that gives us country size in square kilometers by country. We will use this data to put together with our df dataframe.</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>countrysize_url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/bcgov/ds-intro-to-python/main/data/countrysize.csv"</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>countrysize <span class="op">=</span> pd.read_csv(countrysize_url, encoding<span class="op">=</span> <span class="st">'unicode_escape'</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>countrysize.info()</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>countrysize.sample(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 235 entries, 0 to 234
Data columns (total 2 columns):
 #   Column           Non-Null Count  Dtype 
---  ------           --------------  ----- 
 0   nation           235 non-null    object
 1   area_square_kms  235 non-null    int64 
dtypes: int64(1), object(1)
memory usage: 3.8+ KB</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="22">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>nation</th>
      <th>area_square_kms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>41</th>
      <td>Somalia</td>
      <td>637657</td>
    </tr>
    <tr>
      <th>53</th>
      <td>Cameroon</td>
      <td>475442</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Ok, this <code>countrysize</code> dataset looks like we expect - a list of countries alongside the land size of that country in square kilometers. There are some omissions in this list - not all countries in our <code>df</code> dataset are present in this <code>countrysize</code> object. But for our present purposes this is ok. We just want to get that square kilometers data into a combined dataset and it is sufficient for that.</p>
<p>Essentially what we want to do is a classic “left-join” operation of the sort in the diagram below. Conceptually, the <code>df</code> dataset is like the purple table and the <code>countrysize</code> dataset is like the red one.</p>
<center>
<img src="images/exploring-data-structures/join_types.png" width="700" style="margin:auto">
<p style="text-align: center">
Types of Joins
</p>
<br>
</center>
<p>The <code>.merge()</code> method (https://pandas.pydata.org/docs/reference/api/pandas.merge.html) works similarly to how table joining works in <code>SQL</code> or how the <code>VLOOKUP</code> function works in Excel. One needs to specify both dataframes, the key variables on which to join them, and the kind of join desired.</p>
<p>So let’s look at the example below to see how it all comes together in code.</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>combined_df <span class="op">=</span> df.merge(countrysize, left_on<span class="op">=</span><span class="st">'country'</span>, right_on<span class="op">=</span><span class="st">'nation'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>combined_df.head(<span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
      <th>pop_millions</th>
      <th>nation</th>
      <th>area_square_kms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1952</td>
      <td>8425333.0</td>
      <td>Asia</td>
      <td>28.801</td>
      <td>779.445314</td>
      <td>8.425333</td>
      <td>Afghanistan</td>
      <td>652230.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1957</td>
      <td>9240934.0</td>
      <td>Asia</td>
      <td>30.332</td>
      <td>820.853030</td>
      <td>9.240934</td>
      <td>Afghanistan</td>
      <td>652230.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>When you run the code above you will notice that both the <code>nation</code> key column and the <code>area_square_kms</code> column have been joined together in the new <code>combined_df</code> object. One can keep that nation column in there for control purposes, or it can be removed by using the <code>.drop()</code> method we used earlier:</p>
<p>combined_df = combined_df.drop(‘nation’, axis=1)</p>
<p>Another innovative way to put “merge” data together in pandas is with the <code>.concat()</code> function. Conceptually you can think if it like “stacking” two data objects on top of each other or side-by-side as shown in the diagram below.</p>
<center>
<img src="images/exploring-data-structures/concat.png" width="700" style="margin:auto">
<p style="text-align: center">
Ways to stack data
</p>
<br>
</center>
<p>To illustrate, let’s fetch two simple dataframes. Each contains the average scores for three subjects by year for two separate schools.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>school1_url  <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/bcgov/ds-intro-to-python/main/data/school1.csv"</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>school2_url  <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/bcgov/ds-intro-to-python/main/data/school2.csv"</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>school1_df <span class="op">=</span> pd.read_csv(school1_url)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>school2_df <span class="op">=</span> pd.read_csv(school2_url)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a quick look at the two dataframes.</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>school1_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Subject</th>
      <th>Avg Score 2018</th>
      <th>Avg Score 2019</th>
      <th>Avg Score 2020</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Science</td>
      <td>67</td>
      <td>88</td>
      <td>89</td>
    </tr>
    <tr>
      <th>1</th>
      <td>English</td>
      <td>86</td>
      <td>67</td>
      <td>77</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Math</td>
      <td>84</td>
      <td>73</td>
      <td>75</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>school2_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Subject</th>
      <th>Avg Score 2018</th>
      <th>Avg Score 2019</th>
      <th>Avg Score 2020</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Science</td>
      <td>32</td>
      <td>88</td>
      <td>90</td>
    </tr>
    <tr>
      <th>1</th>
      <td>English</td>
      <td>88</td>
      <td>44</td>
      <td>77</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Math</td>
      <td>84</td>
      <td>73</td>
      <td>53</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We call <code>.concat()</code> and pass in the objects that we want to stack vertically. This is a similiar operation to <code>union</code> in <code>SQL</code>.</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>vertical_stack_df <span class="op">=</span> pd.concat([school1_df, school2_df])</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>vertical_stack_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Subject</th>
      <th>Avg Score 2018</th>
      <th>Avg Score 2019</th>
      <th>Avg Score 2020</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Science</td>
      <td>67</td>
      <td>88</td>
      <td>89</td>
    </tr>
    <tr>
      <th>1</th>
      <td>English</td>
      <td>86</td>
      <td>67</td>
      <td>77</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Math</td>
      <td>84</td>
      <td>73</td>
      <td>75</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Science</td>
      <td>32</td>
      <td>88</td>
      <td>90</td>
    </tr>
    <tr>
      <th>1</th>
      <td>English</td>
      <td>88</td>
      <td>44</td>
      <td>77</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Math</td>
      <td>84</td>
      <td>73</td>
      <td>53</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>It is also possible to stack the data horizontally. Here it is necessary to specify the columnar axis (axis=1) as the default setting is for rows (axis=0).</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>horizontal_stack <span class="op">=</span> pd.concat([school1_df, school2_df], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>horizontal_stack</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Subject</th>
      <th>Avg Score 2018</th>
      <th>Avg Score 2019</th>
      <th>Avg Score 2020</th>
      <th>Subject</th>
      <th>Avg Score 2018</th>
      <th>Avg Score 2019</th>
      <th>Avg Score 2020</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Science</td>
      <td>67</td>
      <td>88</td>
      <td>89</td>
      <td>Science</td>
      <td>32</td>
      <td>88</td>
      <td>90</td>
    </tr>
    <tr>
      <th>1</th>
      <td>English</td>
      <td>86</td>
      <td>67</td>
      <td>77</td>
      <td>English</td>
      <td>88</td>
      <td>44</td>
      <td>77</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Math</td>
      <td>84</td>
      <td>73</td>
      <td>75</td>
      <td>Math</td>
      <td>84</td>
      <td>73</td>
      <td>53</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This introduction only scratches the surface of how to leverage this way of joining datasets together. But it can be a powerful tool in the toolkit for the right use case. More detail found here: https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html</p>
</section>
<section id="grouping-and-summarizing" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="grouping-and-summarizing"><span class="header-section-number">3.7</span> Grouping and summarizing</h2>
<p>Sometimes of course you would prefer to group rows together for the purpose of summarizing them in various ways.</p>
<p>We can accomplish this using the <code>.groupby()</code> method. A <code>.groupby()</code> operation involves some combination of splitting the object, applying a function, and combining the results. It is used together with one or more aggregation functions:</p>
<ul>
<li><code>count()</code>: Total number of items</li>
<li><code>first()</code>, <code>last()</code>: First and last item</li>
<li><code>mean()</code>, <code>median()</code>: Mean and median</li>
<li><code>min()</code>, <code>max()</code>: Minimum and maximum</li>
<li><code>std()</code>, <code>var()</code>: Standard deviation and variance</li>
<li><code>mad()</code>: Mean absolute deviation</li>
<li><code>prod()</code>: Product of all items</li>
<li><code>sum()</code>: Sum of all items</li>
</ul>
<p>With our data, let’s use these tools to get population mean, min and max by continent. Here’s how it works.</p>
<p>First we place “continent” in the <code>.groupby()</code> function, then we pass the aggregation functions “mean”, “min”, and “max” as a dictionary within the <code>.agg()</code> function. This dictionary takes the column that we are aggregating - in this case life expectancy - as a key and the aggregation functions as its value.</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>grouped_single <span class="op">=</span> df.groupby(<span class="st">'continent'</span>).agg({<span class="st">'lifeExp'</span>: [<span class="st">'mean'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>]})</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>grouped_single.columns <span class="op">=</span> [<span class="st">'lifeExp_mean'</span>, <span class="st">'lifeExp_min'</span>, <span class="st">'lifeExp_max'</span>]</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>grouped_single.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>lifeExp_mean</th>
      <th>lifeExp_min</th>
      <th>lifeExp_max</th>
    </tr>
    <tr>
      <th>continent</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Africa</th>
      <td>48.865330</td>
      <td>23.599</td>
      <td>76.442</td>
    </tr>
    <tr>
      <th>Americas</th>
      <td>64.658737</td>
      <td>37.579</td>
      <td>80.653</td>
    </tr>
    <tr>
      <th>Asia</th>
      <td>60.064903</td>
      <td>28.801</td>
      <td>82.603</td>
    </tr>
    <tr>
      <th>Europe</th>
      <td>71.903686</td>
      <td>43.585</td>
      <td>81.757</td>
    </tr>
    <tr>
      <th>Oceania</th>
      <td>74.326208</td>
      <td>69.120</td>
      <td>81.235</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We can nest additional “groups within groups” by creating a list of column names and passing that to the <code>.groupby()</code> function instead of passing a single string value. The example below adds more granularity with the introduction of ‘country’ and the creation of a list to hold both ‘continent’ and ‘country’.</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>grouped_multiple <span class="op">=</span> df.groupby([<span class="st">'continent'</span>, <span class="st">'country'</span>]).agg({<span class="st">'pop'</span>: [<span class="st">'mean'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>]})</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>grouped_multiple.columns <span class="op">=</span> [<span class="st">'pop_mean'</span>, <span class="st">'pop_min'</span>, <span class="st">'pop_max'</span>]</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>grouped_multiple.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>pop_mean</th>
      <th>pop_min</th>
      <th>pop_max</th>
    </tr>
    <tr>
      <th>continent</th>
      <th>country</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="10" valign="top">Africa</th>
      <th>Algeria</th>
      <td>1.987541e+07</td>
      <td>9279525.0</td>
      <td>33333216.0</td>
    </tr>
    <tr>
      <th>Angola</th>
      <td>7.309390e+06</td>
      <td>4232095.0</td>
      <td>12420476.0</td>
    </tr>
    <tr>
      <th>Benin</th>
      <td>4.017497e+06</td>
      <td>1738315.0</td>
      <td>8078314.0</td>
    </tr>
    <tr>
      <th>Botswana</th>
      <td>9.711862e+05</td>
      <td>442308.0</td>
      <td>1639131.0</td>
    </tr>
    <tr>
      <th>Burkina Faso</th>
      <td>7.548677e+06</td>
      <td>4469979.0</td>
      <td>14326203.0</td>
    </tr>
    <tr>
      <th>Burundi</th>
      <td>4.651608e+06</td>
      <td>2445618.0</td>
      <td>8390505.0</td>
    </tr>
    <tr>
      <th>Cameroon</th>
      <td>9.816648e+06</td>
      <td>5009067.0</td>
      <td>17696293.0</td>
    </tr>
    <tr>
      <th>Central African Republic</th>
      <td>2.560963e+06</td>
      <td>1291695.0</td>
      <td>4369038.0</td>
    </tr>
    <tr>
      <th>Chad</th>
      <td>5.329256e+06</td>
      <td>2682462.0</td>
      <td>10238807.0</td>
    </tr>
    <tr>
      <th>Comoros</th>
      <td>3.616839e+05</td>
      <td>153936.0</td>
      <td>710960.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge 4
</div>
</div>
<div class="callout-body-container callout-body">
<p>You would like to summarize life expectancy by year for each continent so you can get an idea of trends from 1997 to 2007. Pick some aggregations that would make sense to look at for this task.</p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution to Challenge 4
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Using what we learned about how to select rows, we should limit the dataframe to rows where the year is greater than or equal to 1997. Next we should create a multicolumn call to the <code>.groupby()</code> function. Finally we should select some aggregations such as mean, min, and max among others could make sense here.</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>df_current <span class="op">=</span> df[df[<span class="st">'year'</span>] <span class="op">&gt;=</span> <span class="dv">1997</span>]</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>cont_year <span class="op">=</span> df_current.groupby([<span class="st">'continent'</span>, <span class="st">'year'</span>]).agg({<span class="st">'lifeExp'</span>: [<span class="st">'mean'</span>, <span class="st">'median'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>]})</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>cont_year.columns <span class="op">=</span> [<span class="st">'lifeExp_mean'</span>, <span class="st">'lifeExp_median'</span>, <span class="st">'lifeExp_min'</span>, <span class="st">'lifeExp_max'</span>]</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>cont_year.head(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="31">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>lifeExp_mean</th>
      <th>lifeExp_median</th>
      <th>lifeExp_min</th>
      <th>lifeExp_max</th>
    </tr>
    <tr>
      <th>continent</th>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="3" valign="top">Africa</th>
      <th>1997</th>
      <td>53.598269</td>
      <td>52.7590</td>
      <td>36.087</td>
      <td>74.772</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>53.325231</td>
      <td>51.2355</td>
      <td>39.193</td>
      <td>75.744</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>54.806038</td>
      <td>52.9265</td>
      <td>39.613</td>
      <td>76.442</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">Americas</th>
      <th>1997</th>
      <td>71.150480</td>
      <td>72.1460</td>
      <td>56.671</td>
      <td>78.610</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>72.422040</td>
      <td>72.0470</td>
      <td>58.137</td>
      <td>79.770</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>73.608120</td>
      <td>72.8990</td>
      <td>60.916</td>
      <td>80.653</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">Asia</th>
      <th>1997</th>
      <td>68.020515</td>
      <td>70.2650</td>
      <td>41.763</td>
      <td>80.690</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>69.233879</td>
      <td>71.0280</td>
      <td>42.129</td>
      <td>82.000</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>70.728485</td>
      <td>72.3960</td>
      <td>43.828</td>
      <td>82.603</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">Europe</th>
      <th>1997</th>
      <td>75.505167</td>
      <td>76.1160</td>
      <td>68.835</td>
      <td>79.390</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>76.700600</td>
      <td>77.5365</td>
      <td>70.845</td>
      <td>80.620</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>77.648600</td>
      <td>78.6085</td>
      <td>71.777</td>
      <td>81.757</td>
    </tr>
    <tr>
      <th rowspan="3" valign="top">Oceania</th>
      <th>1997</th>
      <td>78.190000</td>
      <td>78.1900</td>
      <td>77.550</td>
      <td>78.830</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>79.740000</td>
      <td>79.7400</td>
      <td>79.110</td>
      <td>80.370</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>80.719500</td>
      <td>80.7195</td>
      <td>80.204</td>
      <td>81.235</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>By now you should be able to select the rows and columns, join together dataframes, and create some basic summarizations of data. The next section will look at some of the more sophisticated and elegant tools for understanding and presenting your data. But the building blocks you have just learned about are the meat and potatoes of data analysis in the python world.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./00_introduction_to_python.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Python</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>