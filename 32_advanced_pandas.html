<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.313">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to Data Science using Python - 9&nbsp; Advanced Pandas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./33_create_reports.html" rel="next">
<link href="./31_bcdata.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./BCID_H_rgb_rev.png" alt="" class="navbar-logo">
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-introduction-to-python" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Introduction to Python</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-introduction-to-python">    
        <li>
    <a class="dropdown-item" href="./00_introduction_to_python.html">
 <span class="dropdown-text">Getting Up and Running</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./01_working_with_code.html">
 <span class="dropdown-text">Working with Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02_core_data_structure_concepts.html">
 <span class="dropdown-text">Core Concepts</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-get-and-clean-data" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Get and Clean Data</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-get-and-clean-data">    
        <li>
    <a class="dropdown-item" href="./11_getting_data_with_pandas.html">
 <span class="dropdown-text">Getting Data with Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12_cleaning_it_up.html">
 <span class="dropdown-text">Cleaning Data with Pandas</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-understand-and-analyze-data" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Understand and Analyze Data</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-understand-and-analyze-data">    
        <li>
    <a class="dropdown-item" href="./21_exploring_data_structures.html">
 <span class="dropdown-text">Exploring Data Structures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./22_graphical_depictions_of_data.html">
 <span class="dropdown-text">Graphical Depictions of Data</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-advanced-topics" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Advanced Topics</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-advanced-topics">    
        <li>
    <a class="dropdown-item" href="./31_bcdata.html">
 <span class="dropdown-text">bcdata package</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./32_advanced_pandas.html">
 <span class="dropdown-text">Advanced Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./33_create_reports.html">
 <span class="dropdown-text">Creating Reports</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./34_machine_learning.html">
 <span class="dropdown-text">Machine Learning</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./references.html">
 <span class="menu-text">References</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/bcgov/ds-intro-to-python"><i class="bi bi-github" role="img" aria-label="Source Code">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown  compact">
    <a class="nav-link dropdown-toggle" href="#" id="" role="button" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-share" role="img" aria-label="Share">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="">    
        <li>
    <a class="dropdown-item" href="https://twitter.com/intent/tweet?url=|url|"><i class="bi bi-twitter" role="img">
</i> 
 <span class="dropdown-text">Twitter</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|"><i class="bi bi-facebook" role="img">
</i> 
 <span class="dropdown-text">Facebook</span></a>
  </li>  
    </ul>
  </li>
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Pandas</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      <img src="./cover.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">Preface</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./00_introduction_to_python.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Getting Up and Running</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_working_with_code.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Working with Code</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_core_data_structure_concepts.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Core Concepts</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11_getting_data_with_pandas.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Getting Data With Pandas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12_cleaning_it_up.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Cleaning Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./21_exploring_data_structures.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Exploring Data Structures</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./22_graphical_depictions_of_data.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Graphical Depictions of Data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./31_bcdata.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction to bcdata</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./32_advanced_pandas.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Pandas</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./33_create_reports.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Creating Reports</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./34_machine_learning.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Machine Learning</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">References</a>
  </div>
</li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#conditional-column-assignment" id="toc-conditional-column-assignment" class="nav-link active" data-scroll-target="#conditional-column-assignment"><span class="toc-section-number">9.1</span>  Conditional Column Assignment</a>
  <ul>
  <li><a href="#binary-ifelse" id="toc-binary-ifelse" class="nav-link" data-scroll-target="#binary-ifelse">Binary If/Else</a></li>
  <li><a href="#multiple-conditions" id="toc-multiple-conditions" class="nav-link" data-scroll-target="#multiple-conditions">Multiple Conditions</a></li>
  <li><a href="#complex-conditions" id="toc-complex-conditions" class="nav-link" data-scroll-target="#complex-conditions">Complex Conditions</a></li>
  <li><a href="#challenge-1" id="toc-challenge-1" class="nav-link" data-scroll-target="#challenge-1">Challenge 1</a></li>
  </ul></li>
  <li><a href="#advanced-grouping" id="toc-advanced-grouping" class="nav-link" data-scroll-target="#advanced-grouping"><span class="toc-section-number">9.2</span>  Advanced Grouping</a>
  <ul>
  <li><a href="#transform" id="toc-transform" class="nav-link" data-scroll-target="#transform">Transform</a>
  <ul class="collapse">
  <li><a href="#ex.-1-percent-of-group" id="toc-ex.-1-percent-of-group" class="nav-link" data-scroll-target="#ex.-1-percent-of-group">Ex. 1: Percent of Group</a></li>
  <li><a href="#ex-2-grouped-aggregate" id="toc-ex-2-grouped-aggregate" class="nav-link" data-scroll-target="#ex-2-grouped-aggregate">Ex 2: Grouped Aggregate</a></li>
  <li><a href="#ex-3-multiple-series" id="toc-ex-3-multiple-series" class="nav-link" data-scroll-target="#ex-3-multiple-series">Ex 3: Multiple Series</a></li>
  <li><a href="#ex-4-filtering-original-dataframe" id="toc-ex-4-filtering-original-dataframe" class="nav-link" data-scroll-target="#ex-4-filtering-original-dataframe">Ex 4: Filtering Original Dataframe</a></li>
  </ul></li>
  <li><a href="#apply" id="toc-apply" class="nav-link" data-scroll-target="#apply">Apply</a>
  <ul class="collapse">
  <li><a href="#ex-1.-aggregate-over-multiple-columns" id="toc-ex-1.-aggregate-over-multiple-columns" class="nav-link" data-scroll-target="#ex-1.-aggregate-over-multiple-columns">Ex 1. Aggregate over Multiple Columns</a></li>
  <li><a href="#ex-2.-mix-rowaggregate-levels" id="toc-ex-2.-mix-rowaggregate-levels" class="nav-link" data-scroll-target="#ex-2.-mix-rowaggregate-levels">Ex 2. Mix Row/Aggregate Levels</a></li>
  <li><a href="#ex-3.-partial-aggregates" id="toc-ex-3.-partial-aggregates" class="nav-link" data-scroll-target="#ex-3.-partial-aggregates">Ex 3. Partial Aggregates</a></li>
  <li><a href="#ex-4.-create-multiple-columns" id="toc-ex-4.-create-multiple-columns" class="nav-link" data-scroll-target="#ex-4.-create-multiple-columns">Ex 4. Create Multiple Columns</a></li>
  </ul></li>
  <li><a href="#challenge-2" id="toc-challenge-2" class="nav-link" data-scroll-target="#challenge-2">Challenge 2</a></li>
  </ul></li>
  <li><a href="#windowing-functions" id="toc-windowing-functions" class="nav-link" data-scroll-target="#windowing-functions"><span class="toc-section-number">9.3</span>  Windowing Functions</a>
  <ul>
  <li><a href="#rolling" id="toc-rolling" class="nav-link" data-scroll-target="#rolling">Rolling</a></li>
  <li><a href="#cumulative" id="toc-cumulative" class="nav-link" data-scroll-target="#cumulative">Cumulative</a></li>
  <li><a href="#shifts" id="toc-shifts" class="nav-link" data-scroll-target="#shifts">Shifts</a></li>
  <li><a href="#challenge-3" id="toc-challenge-3" class="nav-link" data-scroll-target="#challenge-3">Challenge 3</a></li>
  </ul></li>
  <li><a href="#reshaping-data" id="toc-reshaping-data" class="nav-link" data-scroll-target="#reshaping-data"><span class="toc-section-number">9.4</span>  Reshaping Data</a>
  <ul>
  <li><a href="#long-to-wide" id="toc-long-to-wide" class="nav-link" data-scroll-target="#long-to-wide">Long to Wide</a>
  <ul class="collapse">
  <li><a href="#pivot" id="toc-pivot" class="nav-link" data-scroll-target="#pivot">pivot</a></li>
  <li><a href="#pivot_table" id="toc-pivot_table" class="nav-link" data-scroll-target="#pivot_table">pivot_table</a></li>
  </ul></li>
  <li><a href="#wide-to-long" id="toc-wide-to-long" class="nav-link" data-scroll-target="#wide-to-long">Wide to Long</a>
  <ul class="collapse">
  <li><a href="#melt" id="toc-melt" class="nav-link" data-scroll-target="#melt">melt</a></li>
  </ul></li>
  <li><a href="#challenge-4" id="toc-challenge-4" class="nav-link" data-scroll-target="#challenge-4">Challenge 4</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/bcgov/ds-intro-to-python/blob/main/32_advanced_pandas.qmd" class="toc-action">View source</a></p><p><a href="https://github.com/bcgov/ds-intro-to-python/edit/main/32_advanced_pandas.qmd" class="toc-action">Edit this page</a></p><p><a href="https://github.com/bcgov/ds-intro-to-python/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Advanced Pandas</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<center>
<img src="images/advanced-pandas/advanced_pandas.jpeg" width="60%" style="margin:auto">
<p style="text-align: center">
Advanced. Pandas.
</p>
</center>
<p>In this section we will go over some Pandas functionality that is slightly more involved than the prior sessions. We hope to cover, or at least provide reference for operations such as:</p>
<ul>
<li>Conditional Column Assignment</li>
<li>Advanced grouping techniques</li>
<li>Rolling and cumulative functions</li>
<li>Reshaping our data</li>
</ul>
<section id="conditional-column-assignment" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="conditional-column-assignment"><span class="header-section-number">9.1</span> Conditional Column Assignment</h2>
<p>In our previous sections on Pandas, we introduced the idea of column creation based on the data we currently have. We limited ourselves to fairly standard examples that are likely to crop up in typical data analysis: arithmetic operations, applying column specific functions, and the use of the <code>lambda</code> function inside a call to either <code>apply</code> or <code>assign</code>. Here we will expand our column possibilities to include conditional assignments, where the value of the column is dependent on the value/state of some other column.</p>
<p>Let’s look at the penguins dataset we considered previously. This dataset has a good mix of categorical and numerical datatypes for us to create new columns from.</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> seaborn <span class="im">import</span> load_dataset</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>penguins <span class="op">=</span> load_dataset(<span class="st">'penguins'</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>penguins.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.1</td>
      <td>18.7</td>
      <td>181.0</td>
      <td>3750.0</td>
      <td>Male</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.5</td>
      <td>17.4</td>
      <td>186.0</td>
      <td>3800.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>40.3</td>
      <td>18.0</td>
      <td>195.0</td>
      <td>3250.0</td>
      <td>Female</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>36.7</td>
      <td>19.3</td>
      <td>193.0</td>
      <td>3450.0</td>
      <td>Female</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="binary-ifelse" class="level3">
<h3 class="anchored" data-anchor-id="binary-ifelse">Binary If/Else</h3>
<p>The first type of conditional assignment we will consider is the simplest: <strong>if</strong> original column is <em>value A</em>, <strong>then</strong> assign <em>value x</em>, otherwise assign <em>value y</em>. The most straightforward way to do this is via the apply method again, combined with a lambda function acting on the column of interest. For this example, we are going to make a shorthand version of the <code>sex</code> column - <strong>if</strong> the sex column is <em>Female</em>, <strong>then</strong> assign <em>F</em>, otherwise assign <em>M</em>.</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>penguins[<span class="st">'if_else_column'</span>] <span class="op">=</span> penguins.sex.<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'F'</span> <span class="cf">if</span> x<span class="op">==</span><span class="st">'Female'</span> <span class="cf">else</span> <span class="st">'M'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>penguins[[<span class="st">'sex'</span>, <span class="st">'if_else_column'</span>]].sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="2">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sex</th>
      <th>if_else_column</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>Male</td>
      <td>M</td>
    </tr>
    <tr>
      <th>152</th>
      <td>Female</td>
      <td>F</td>
    </tr>
    <tr>
      <th>336</th>
      <td>NaN</td>
      <td>M</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Female</td>
      <td>F</td>
    </tr>
    <tr>
      <th>221</th>
      <td>Male</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>While apply is robust and can be used in many different applications and settings, it is often the slowest method available in Pandas. If you are doing very specific operations, Pandas often provides faster, vectorized methods to do the same thing. For instance, this if/else example can also be calculated using the Pandas <code>where</code> and <code>mask</code> methods. These methods complement each other, and you may find one more intuitive than the other based on the specific circumstances of the data you are working with.</p>
<p>Both methods assume you already have some column with a default value in place. For example, we can assign the value ‘M’ to an entire column. <code>where</code> and <code>mask</code> then work by updating the values of this column where some other condition is met. The syntax for <code>where</code> is:</p>
<p>If <code>condition</code> is met, keep the default value, otherwise update to the <code>other</code> value:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>penguins[<span class="st">'where_column'</span>] <span class="op">=</span> <span class="st">'M'</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>penguins[<span class="st">'where_column'</span>] <span class="op">=</span> penguins.where_column.where(penguins.sex<span class="op">==</span><span class="st">'Male'</span>, <span class="st">'F'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>penguins[[<span class="st">'sex'</span>, <span class="st">'if_else_column'</span>, <span class="st">'where_column'</span>]].sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="3">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sex</th>
      <th>if_else_column</th>
      <th>where_column</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>186</th>
      <td>Male</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>40</th>
      <td>Female</td>
      <td>F</td>
      <td>F</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Female</td>
      <td>F</td>
      <td>F</td>
    </tr>
    <tr>
      <th>183</th>
      <td>Male</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>335</th>
      <td>Male</td>
      <td>M</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>While the syntax for <code>mask</code> is:</p>
<p>If <code>condition</code> is met, update to <code>other</code> value, otherwise keep the default value:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>penguins[<span class="st">'mask_column'</span>] <span class="op">=</span> <span class="st">'M'</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>penguins[<span class="st">'mask_column'</span>] <span class="op">=</span> penguins.mask_column.mask(penguins.sex<span class="op">==</span><span class="st">'Female'</span>, <span class="st">'F'</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>penguins[[<span class="st">'sex'</span>, <span class="st">'if_else_column'</span>, <span class="st">'where_column'</span>, <span class="st">'mask_column'</span>]].sample(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>sex</th>
      <th>if_else_column</th>
      <th>where_column</th>
      <th>mask_column</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>19</th>
      <td>Male</td>
      <td>M</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>208</th>
      <td>Female</td>
      <td>F</td>
      <td>F</td>
      <td>F</td>
    </tr>
    <tr>
      <th>233</th>
      <td>Male</td>
      <td>M</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>155</th>
      <td>Female</td>
      <td>F</td>
      <td>F</td>
      <td>F</td>
    </tr>
    <tr>
      <th>86</th>
      <td>Male</td>
      <td>M</td>
      <td>M</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Again, while these all result in the same column, you may find one method more intuitive, efficient, or faster for the data you are working with. Explore and use what works best for you!</p>
</section>
<section id="multiple-conditions" class="level3">
<h3 class="anchored" data-anchor-id="multiple-conditions">Multiple Conditions</h3>
<p>Sometimes, a simple if/else statement doesn’t cut it. Perhaps there are multiple options, and creating an <code>if</code>…<code>elseif</code>…<code>elseif</code>…<code>else</code> block will not only only be less intuitive but can easily be used incorrectly, leading to undesired outputs. In this case, the mapping functionality of Pandas provides a vectorized efficient method to create multiple changes to a column. The <code>map</code> method, which we apply to a single series, is optimized for mapping elements from one domain to another. The best example of this is using a dictionary to provide a mapping of your keys (initial column values) to your new value set.</p>
<p>Let’s see this in action with the penguins. Perhaps we do not wish to bias our analysis by having knowledge of which island each penguin came from. In this case, we wish to replace the actual names of the three islands with generic island IDs. First, we supply our mapping dictionary that will transform each island to its generic ID. Then, we supply this dictionary to our <code>map</code> method:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>my_mapping <span class="op">=</span> {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Torgersen'</span>: <span class="st">'Island 1'</span>,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Biscoe'</span>: <span class="st">'Island 2'</span>,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Dream'</span>: <span class="st">'Island 3'</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>penguins[<span class="st">'mapped_islands'</span>] <span class="op">=</span> penguins.island.<span class="bu">map</span>(my_mapping)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>penguins[[<span class="st">'island'</span>, <span class="st">'mapped_islands'</span>]].sample(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="5">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>island</th>
      <th>mapped_islands</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>290</th>
      <td>Biscoe</td>
      <td>Island 2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Torgersen</td>
      <td>Island 1</td>
    </tr>
    <tr>
      <th>106</th>
      <td>Biscoe</td>
      <td>Island 2</td>
    </tr>
    <tr>
      <th>253</th>
      <td>Biscoe</td>
      <td>Island 2</td>
    </tr>
    <tr>
      <th>254</th>
      <td>Biscoe</td>
      <td>Island 2</td>
    </tr>
    <tr>
      <th>48</th>
      <td>Dream</td>
      <td>Island 3</td>
    </tr>
    <tr>
      <th>245</th>
      <td>Biscoe</td>
      <td>Island 2</td>
    </tr>
    <tr>
      <th>303</th>
      <td>Biscoe</td>
      <td>Island 2</td>
    </tr>
    <tr>
      <th>206</th>
      <td>Dream</td>
      <td>Island 3</td>
    </tr>
    <tr>
      <th>218</th>
      <td>Dream</td>
      <td>Island 3</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="complex-conditions" class="level3">
<h3 class="anchored" data-anchor-id="complex-conditions">Complex Conditions</h3>
<p>The above example used the <code>map</code> method, which is inherently a method to be used for <code>Series</code> only. As such, we cannot use it for more complicated conditions that may involve multiple columns. The final example we will consider is a more complicated set of conditions: we wish to create new categories based on the penguins body mass: underweight, overweight, or average weight. However, we also wish to consider the penguin species when creating these categories: what is underweight for the Gentoo species may be overweight for the Adelie! Thus, in theory we have 9 new categories to account for that depend on two columns.</p>
<p>The best (read: efficient) way to approach this multi-column multi-conditional scenario is actually to go outside of the Pandas toolkit and use a tool that has been implemented by <code>numpy</code>. Numpy is a computational tool-kit for Python that utilizes the efficiency of powerful computational languages such as Fortran and C to provide fast and versatile computational tools for the vast majority of numerical and scientific anaylsis in Python. We have seen it already, having used numpy’s statistical functions such as <code>mean</code> and <code>median</code> within our aggregations. Here, we wish to make use of the <code>numpy.select()</code> method.</p>
<p>In numpy, the <code>select</code> method is fairly simple. We supply a list of conditions we wish to consider, and a list of choices for what we wish to happen for each of the conditions. We may also supply a default value, for if none of the conditions are met. <code>select</code> will go through the list one by one, and will apply the choice for the first condition that is met. Let’s see what this looks like for our penguins:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co"># list all possible combos of species and specific body masses</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># note that we don't include the overweight combos, as we can catch these</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co"># with the default option in select!</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>conditions <span class="op">=</span> [</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    (penguins.species<span class="op">==</span><span class="st">'Adelie'</span>) <span class="op">&amp;</span> (penguins.body_mass_g<span class="op">&lt;</span><span class="dv">3300</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    (penguins.species<span class="op">==</span><span class="st">'Adelie'</span>) <span class="op">&amp;</span> (penguins.body_mass_g<span class="op">&lt;</span><span class="dv">3700</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    (penguins.species<span class="op">==</span><span class="st">'Chinstrap'</span>) <span class="op">&amp;</span> (penguins.body_mass_g<span class="op">&lt;</span><span class="dv">3333</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    (penguins.species<span class="op">==</span><span class="st">'Chinstrap'</span>) <span class="op">&amp;</span> (penguins.body_mass_g<span class="op">&lt;</span><span class="dv">3733</span>),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    (penguins.species<span class="op">==</span><span class="st">'Gentoo'</span>) <span class="op">&amp;</span> (penguins.body_mass_g<span class="op">&lt;</span><span class="dv">4676</span>),</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    (penguins.species<span class="op">==</span><span class="st">'Gentoo'</span>) <span class="op">&amp;</span> (penguins.body_mass_g<span class="op">&lt;</span><span class="dv">5076</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># for each listed condition, tell select what value to use</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>choices <span class="op">=</span> [</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Underweight'</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Average weight'</span>, </span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Underweight'</span>, </span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Average weight'</span>,</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Underweight'</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Average weight'</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a><span class="co"># use select to create our new column</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>penguins[<span class="st">'general_weight'</span>] <span class="op">=</span> np.select(conditions, choices, default<span class="op">=</span><span class="st">'Overweight'</span>)</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="co"># display results</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>penguins[[<span class="st">'species'</span>, <span class="st">'body_mass_g'</span>, <span class="st">'general_weight'</span>]].sample(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="6">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>species</th>
      <th>body_mass_g</th>
      <th>general_weight</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>221</th>
      <td>Gentoo</td>
      <td>5700.0</td>
      <td>Overweight</td>
    </tr>
    <tr>
      <th>105</th>
      <td>Adelie</td>
      <td>3550.0</td>
      <td>Average weight</td>
    </tr>
    <tr>
      <th>181</th>
      <td>Chinstrap</td>
      <td>4550.0</td>
      <td>Overweight</td>
    </tr>
    <tr>
      <th>219</th>
      <td>Chinstrap</td>
      <td>3775.0</td>
      <td>Overweight</td>
    </tr>
    <tr>
      <th>169</th>
      <td>Chinstrap</td>
      <td>3700.0</td>
      <td>Average weight</td>
    </tr>
    <tr>
      <th>293</th>
      <td>Gentoo</td>
      <td>5200.0</td>
      <td>Overweight</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Adelie</td>
      <td>3800.0</td>
      <td>Overweight</td>
    </tr>
    <tr>
      <th>285</th>
      <td>Gentoo</td>
      <td>5700.0</td>
      <td>Overweight</td>
    </tr>
    <tr>
      <th>62</th>
      <td>Adelie</td>
      <td>3600.0</td>
      <td>Average weight</td>
    </tr>
    <tr>
      <th>141</th>
      <td>Adelie</td>
      <td>3475.0</td>
      <td>Average weight</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Order Matters!
</div>
</div>
<div class="callout-body-container callout-body">
<p>When using the <code>select</code> method, the order of the conditions matters! Numpy always goes through the list in order, looking for the first <code>TRUE</code> condition. This ordering will matter, for example, if creating a list of bins for some numerical category. Conditions of the form:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>conditions <span class="op">=</span> [</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    penguins.body_mass_g <span class="op">&lt;</span> <span class="dv">5_000</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    penguins.body_mass_g <span class="op">&lt;</span> <span class="dv">4_000</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    penguins.body_mass_g <span class="op">&lt;</span> <span class="dv">3_000</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    penguins.body_mass_g <span class="op">&lt;</span> <span class="dv">2_000</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    penguins.body_mass_g <span class="op">&lt;</span> <span class="dv">1_000</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Will never evaluate the choices for the conditions 2-5, as the first condition will be true as well. Instead we should flip this list and write our conditions starting from 1,000 and ending at 5,000. Keep this in mind when creating your conditions!</p>
</div>
</div>
</section>
<section id="challenge-1" class="level3">
<h3 class="anchored" data-anchor-id="challenge-1">Challenge 1</h3>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge 1
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a column for 5-10 flipper length bins and plot the resulting frequencies (counts for each bin).</p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution to Challenge 1
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Here we’re going to pull together some Seaborn code and our new-found conditional knowledge to create the bins.</p>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make sure seaborn is imported</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># check roughly where we could place bins</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>display(penguins.agg({<span class="st">'flipper_length_mm'</span>: [<span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'min'</span>, <span class="st">'max'</span>]}))</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co"># create some conditions for bins</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>conditions <span class="op">=</span> [</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    penguins.flipper_length_mm <span class="op">&lt;</span> <span class="dv">180</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    penguins.flipper_length_mm <span class="op">&lt;</span> <span class="dv">190</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    penguins.flipper_length_mm <span class="op">&lt;</span> <span class="dv">200</span>,</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    penguins.flipper_length_mm <span class="op">&lt;</span> <span class="dv">210</span>,</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    penguins.flipper_length_mm <span class="op">&lt;</span> <span class="dv">220</span>,</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    penguins.flipper_length_mm <span class="op">&lt;</span> <span class="dv">230</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co"># assign names to each condition</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>choices <span class="op">=</span> [</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'0 - 180'</span>,</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'180 - 190'</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'190 - 200'</span>,</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'200 - 210'</span>,</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'210 - 220'</span>,</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'220 - 230'</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co"># add the new column</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>penguins[<span class="st">'flipper_length_bins'</span>] <span class="op">=</span> np.select(conditions, choices, default<span class="op">=</span><span class="st">'230 +'</span>)</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co"># plot this data using the 'count' option</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>sns.catplot(</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>    penguins, </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'flipper_length_bins'</span>, </span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>    kind<span class="op">=</span><span class="st">'count'</span>,</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>    order <span class="op">=</span> choices,</span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">'blue'</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>flipper_length_mm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>mean</th>
      <td>200.915205</td>
    </tr>
    <tr>
      <th>std</th>
      <td>14.061714</td>
    </tr>
    <tr>
      <th>min</th>
      <td>172.000000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>231.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<p><img src="32_advanced_pandas_files/figure-html/cell-9-output-2.png" width="470" height="512"></p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="advanced-grouping" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="advanced-grouping"><span class="header-section-number">9.2</span> Advanced Grouping</h2>
<center>
<img src="images/advanced-pandas/pandas_group.jpg" width="40%" style="margin:auto">
<p style="text-align: center">
<code>groupby cuteness</code>
</p>
</center>
<p>In our previous section on Pandas, we explored the basic tools we need to group our data by various columns, apply a host of statistical aggregation operations, and look at these outcomes. While incredibly powerful as is, these tools lack some functionality that you might wish to have. Some examples include:</p>
<ul>
<li>Combining row level values and group level aggregations in a single command.</li>
<li>Filtering and subsetting a dataframe based on group values.</li>
<li>Combining aggregations across different columns.</li>
</ul>
<p>In order to handle these operations, we need to introduce two new methods: <code>transform</code> and <code>apply</code>.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Apply… again?
</div>
</div>
<div class="callout-body-container callout-body">
<p>You might question whether <code>apply</code> is actually a new function, seeing as we have used it previously when creating new columns in a dataframe. In fact, the effect of <code>apply</code> within pandas is subtly different depending on how and where we apply it. The effect of <code>apply</code> is different when used on:</p>
<ul>
<li>A dataframe as a whole - <code>dataframe.apply(...)</code></li>
<li>A single series - <code>series.apply(...)</code></li>
<li>A grouped dataframe object - <code>dataframe.groupby('column').apply(...)</code></li>
</ul>
<p>Make sure you keep track of what kind of apply you are using when doing your dataframe manipulations, as identical functions in different scenarios can lead to unusually different results! In this section, we are focusing on the <strong>grouped dataframe objects</strong>.</p>
</div>
</div>
<p>Both <code>transform</code> and <code>apply</code> can be used on a grouped dataframe object. This is the object that is created when we use the <code>.groupby()</code> method. Let’s create a small dataset and see what this object looks like:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>starwars <span class="op">=</span> pd.DataFrame(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'unit'</span> : [</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Blaster'</span>, <span class="st">'Blaster'</span>, <span class="st">'Blaster'</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Lightsaber'</span>, <span class="st">'Lightsaber'</span>, <span class="st">'Lightsaber'</span>, <span class="st">'Lightsaber'</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>            <span class="st">'Stick'</span>, <span class="st">'Stick'</span>, <span class="st">'Stick'</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>            ], </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cost'</span> : [<span class="dv">42</span>, <span class="dv">60</span>, <span class="dv">40</span>, <span class="dv">900</span>, <span class="dv">4000</span>, <span class="dv">2000</span>, <span class="dv">100</span>, <span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">5</span>],</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'sale_price'</span> : [<span class="dv">50</span>, <span class="dv">75</span>, <span class="dv">42</span>, <span class="dv">1000</span>, <span class="dv">5000</span>, <span class="dv">2000</span>, <span class="dv">4242</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">20</span>]</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>starwars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="9">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unit</th>
      <th>cost</th>
      <th>sale_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Blaster</td>
      <td>42</td>
      <td>50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Blaster</td>
      <td>60</td>
      <td>75</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Blaster</td>
      <td>40</td>
      <td>42</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Lightsaber</td>
      <td>900</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Lightsaber</td>
      <td>4000</td>
      <td>5000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Lightsaber</td>
      <td>2000</td>
      <td>2000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lightsaber</td>
      <td>100</td>
      <td>4242</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Stick</td>
      <td>10</td>
      <td>4</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Stick</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Stick</td>
      <td>5</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Here we have a column that looks categorical (<code>unit</code>), and a couple that look numerical (<code>cost</code> and <code>sale_price</code>). We are going to focus on grouping our data according to the categorical column, and see what we can do with the numerical columns.</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>grouped_starwars <span class="op">=</span> starwars.groupby(<span class="st">'unit'</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>grouped_starwars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="10">
<pre><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x7ffae0435310&gt;</code></pre>
</div>
</div>
<p>Note that this object is no longer a dataframe, but some sort of <code>DataFrameGroupBy</code> object. By itself, it is not very useful, but we can use it to get all sorts of interesting information. Recall briefly how we used this earlier. Maybe we want the average buy and sell prices of each type of unit:</p>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>grouped_starwars.mean().reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="11">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unit</th>
      <th>cost</th>
      <th>sale_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Blaster</td>
      <td>47.333333</td>
      <td>55.666667</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Lightsaber</td>
      <td>1750.000000</td>
      <td>3060.500000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Stick</td>
      <td>5.333333</td>
      <td>8.666667</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>What if we wanted to know how much each particular unit contributed to it’s groups overall sale? Or perhaps how much each group profited, on average? This is where <code>transform</code> and <code>apply</code> come in. Let’s look at what each of these do.</p>
<section id="transform" class="level3">
<h3 class="anchored" data-anchor-id="transform">Transform</h3>
<ul>
<li>Used to apply a function to a dataframe that produces a new dataframe with the same shape as the original.</li>
<li>While an entire dataframe can be passed to transform, it only ever sees (operates on) a single column/series at a time.</li>
<li>The function must either return a scalar value or a sequence that is the <strong>same length</strong> as the original dataframe.</li>
<li>Useful for getting groups aggregations back into the original dataframe</li>
<li>Useful for filtering based on group values</li>
</ul>
<section id="ex.-1-percent-of-group" class="level4">
<h4 class="anchored" data-anchor-id="ex.-1-percent-of-group">Ex. 1: Percent of Group</h4>
<p>Let’s see each this in action. We will use transform to determine how much each unit contributed to the total sales of its group.</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pct_of_sales <span class="op">=</span> (</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    grouped_starwars</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    .sale_price</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    .transform(<span class="kw">lambda</span> series_: series_<span class="op">/</span>series_.<span class="bu">sum</span>())</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>pct_of_sales</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>0    0.299401
1    0.449102
2    0.251497
3    0.081686
4    0.408430
5    0.163372
6    0.346512
7    0.153846
8    0.076923
9    0.769231
Name: sale_price, dtype: float64</code></pre>
</div>
</div>
<p>Notice here that we used the <code>lambda</code> function again, which allows us to define a function inline acting on a given argument (in this case, the argument is named <code>series_</code>). This let us allow the value of the series to be the sum of the series. Because we are acting on a <em>grouped</em> object, Pandas knows that the sum we wish to employ is that of the group, not the overall sum! This new object will be in the same order (have the same indexing) as our initial dataframe, and so we can add it back to the dataframe as an extra column if we wish. This works explicitly because the transform method is required to return a series of the same length as the original object, giving us exactly what we want!</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>starwars[<span class="st">'percent_of_sales'</span>] <span class="op">=</span> pct_of_sales</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>starwars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="13">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unit</th>
      <th>cost</th>
      <th>sale_price</th>
      <th>percent_of_sales</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Blaster</td>
      <td>42</td>
      <td>50</td>
      <td>0.299401</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Blaster</td>
      <td>60</td>
      <td>75</td>
      <td>0.449102</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Blaster</td>
      <td>40</td>
      <td>42</td>
      <td>0.251497</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Lightsaber</td>
      <td>900</td>
      <td>1000</td>
      <td>0.081686</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Lightsaber</td>
      <td>4000</td>
      <td>5000</td>
      <td>0.408430</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Lightsaber</td>
      <td>2000</td>
      <td>2000</td>
      <td>0.163372</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lightsaber</td>
      <td>100</td>
      <td>4242</td>
      <td>0.346512</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Stick</td>
      <td>10</td>
      <td>4</td>
      <td>0.153846</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Stick</td>
      <td>1</td>
      <td>2</td>
      <td>0.076923</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Stick</td>
      <td>5</td>
      <td>20</td>
      <td>0.769231</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="ex-2-grouped-aggregate" class="level4">
<h4 class="anchored" data-anchor-id="ex-2-grouped-aggregate">Ex 2: Grouped Aggregate</h4>
<p>Transform can be used exclusively with an aggregation function as well, but it will still return a value for every row of the initial dataset. This allows us to add grouped level values as columns to the data:</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>starwars[<span class="st">'average_unit_cost'</span>] <span class="op">=</span> grouped_starwars.cost.transform(<span class="st">'mean'</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>starwars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="14">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unit</th>
      <th>cost</th>
      <th>sale_price</th>
      <th>percent_of_sales</th>
      <th>average_unit_cost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Blaster</td>
      <td>42</td>
      <td>50</td>
      <td>0.299401</td>
      <td>47.333333</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Blaster</td>
      <td>60</td>
      <td>75</td>
      <td>0.449102</td>
      <td>47.333333</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Blaster</td>
      <td>40</td>
      <td>42</td>
      <td>0.251497</td>
      <td>47.333333</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Lightsaber</td>
      <td>900</td>
      <td>1000</td>
      <td>0.081686</td>
      <td>1750.000000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Lightsaber</td>
      <td>4000</td>
      <td>5000</td>
      <td>0.408430</td>
      <td>1750.000000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Lightsaber</td>
      <td>2000</td>
      <td>2000</td>
      <td>0.163372</td>
      <td>1750.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lightsaber</td>
      <td>100</td>
      <td>4242</td>
      <td>0.346512</td>
      <td>1750.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Stick</td>
      <td>10</td>
      <td>4</td>
      <td>0.153846</td>
      <td>5.333333</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Stick</td>
      <td>1</td>
      <td>2</td>
      <td>0.076923</td>
      <td>5.333333</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Stick</td>
      <td>5</td>
      <td>20</td>
      <td>0.769231</td>
      <td>5.333333</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="ex-3-multiple-series" class="level4">
<h4 class="anchored" data-anchor-id="ex-3-multiple-series">Ex 3: Multiple Series</h4>
<p>Instead of passing a single column to the transform method, we could also pass the entire dataframe (or some subset of the columns in the dataframe), and calculate values for each series:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>grouped_starwars.transform(<span class="kw">lambda</span> series_: (series_<span class="op">-</span>series_.mean())<span class="op">/</span>series_.std())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>cost</th>
      <th>sale_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.484182</td>
      <td>-0.329183</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.149932</td>
      <td>1.123095</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.665750</td>
      <td>-0.793912</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-0.502909</td>
      <td>-1.099922</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.331229</td>
      <td>1.035331</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.147914</td>
      <td>-0.566109</td>
    </tr>
    <tr>
      <th>6</th>
      <td>-0.976235</td>
      <td>0.630700</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1.034910</td>
      <td>-0.473016</td>
    </tr>
    <tr>
      <th>8</th>
      <td>-0.960988</td>
      <td>-0.675737</td>
    </tr>
    <tr>
      <th>9</th>
      <td>-0.073922</td>
      <td>1.148754</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This has created two columns that have both had the same function applied. Note that if we wanted to merge these in with the original dataframe, we should be careful to rename the columns so that they do not overlap!</p>
</section>
<section id="ex-4-filtering-original-dataframe" class="level4">
<h4 class="anchored" data-anchor-id="ex-4-filtering-original-dataframe">Ex 4: Filtering Original Dataframe</h4>
<p>Another use case for transform is in filtering a dataframe. Maybe we want to zero in on those items where the sale price of the object was less than the average unit cost. Let’s filter our dataframe to only those rows:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>condition <span class="op">=</span> starwars.sale_price <span class="op">&lt;</span> grouped_starwars.cost.transform(<span class="kw">lambda</span> x: x.mean())</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>starwars[condition]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="16">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unit</th>
      <th>cost</th>
      <th>sale_price</th>
      <th>percent_of_sales</th>
      <th>average_unit_cost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2</th>
      <td>Blaster</td>
      <td>40</td>
      <td>42</td>
      <td>0.251497</td>
      <td>47.333333</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Lightsaber</td>
      <td>900</td>
      <td>1000</td>
      <td>0.081686</td>
      <td>1750.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Stick</td>
      <td>10</td>
      <td>4</td>
      <td>0.153846</td>
      <td>5.333333</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Stick</td>
      <td>1</td>
      <td>2</td>
      <td>0.076923</td>
      <td>5.333333</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="apply" class="level3">
<h3 class="anchored" data-anchor-id="apply">Apply</h3>
<ul>
<li>Used to apply a function (aggregated or otherwise) across multiple columns</li>
<li>Implicitly passes all the columns of the dataframe <em>as</em> a dataframe to the function, allowing for column interactions</li>
<li>The function can return a scalar or a sequence of any length.</li>
</ul>
<section id="ex-1.-aggregate-over-multiple-columns" class="level4">
<h4 class="anchored" data-anchor-id="ex-1.-aggregate-over-multiple-columns">Ex 1. Aggregate over Multiple Columns</h4>
<p>Let’s try something with apply. What if we want to know the average overall profit of each group. We could produce a profit column, group up on the unit, and then calculate the mean.</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>starwars[<span class="st">'profit'</span>] <span class="op">=</span> starwars.sale_price <span class="op">-</span> starwars.cost</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>starwars.groupby(<span class="st">'unit'</span>).profit.mean()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>unit
Blaster          8.333333
Lightsaber    1310.500000
Stick            3.333333
Name: profit, dtype: float64</code></pre>
</div>
</div>
<p>We could also do this using the apply function, applied to our grouped object:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>grouped_starwars.<span class="bu">apply</span>(<span class="kw">lambda</span> df_: (df_.sale_price <span class="op">-</span> df_.cost).mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>unit
Blaster          8.333333
Lightsaber    1310.500000
Stick            3.333333
dtype: float64</code></pre>
</div>
</div>
<p>Again, we made use of that <code>lambda</code> function, this time applying it to a <code>df_</code> argument. You might notice that here I used a <code>df_</code> argument instead of <code>series_</code>: this is merely notation, and we could have used anything (<code>series_</code>, <code>df_</code>, <code>x</code>, <code>this_is_my_argument</code> would all work the same). However, we have used <code>df_</code> and <code>series_</code> so that we can remind ourselves exactly what type of object we are acting on.</p>
<p>To see how transform differs from apply, let’s try to do that exact same operation:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>grouped_starwars.transform(<span class="kw">lambda</span> _df: (_df.sale_price <span class="op">-</span> _df.cost).mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'Series' object has no attribute 'sale_price'</code></pre>
</div>
</div>
<p>This fails because the object being acted on inside transform is itself just a series object, not the entire dataframe! As such, it has no attribute for <code>sale_price</code> or <code>buy_price</code> like our original dataframe does. Instead, it acts on the <code>sale_price</code> series, then the <code>buy_price</code> series, and returns the results.</p>
</section>
<section id="ex-2.-mix-rowaggregate-levels" class="level4">
<h4 class="anchored" data-anchor-id="ex-2.-mix-rowaggregate-levels">Ex 2. Mix Row/Aggregate Levels</h4>
<p>While the first apply example returns a rolled up aggregated dataframe, we can also use apply to return the individual rows of the dataframe by mixing aggregation functions with row level functions.</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>grouped_starwars.<span class="bu">apply</span>(<span class="kw">lambda</span> df_: df_.sale_price <span class="op">-</span> df_.cost.mean())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>unit         
Blaster     0       2.666667
            1      27.666667
            2      -5.333333
Lightsaber  3    -750.000000
            4    3250.000000
            5     250.000000
            6    2492.000000
Stick       7      -1.333333
            8      -3.333333
            9      14.666667
Name: sale_price, dtype: float64</code></pre>
</div>
</div>
<p>In this way we have to be careful: transform will <strong>always</strong> return a dataframe that is the same size as the original, while apply will return something that varies with the type of function we have utilized.</p>
</section>
<section id="ex-3.-partial-aggregates" class="level4">
<h4 class="anchored" data-anchor-id="ex-3.-partial-aggregates">Ex 3. Partial Aggregates</h4>
<p>Apply lets us play some cool tricks as well. Suppose we only wanted to know about the two most expensive sales in each category. How could we filter to show this? We can use the <code>nlargest</code> (or smallest) method in conjunction with apply. <code>nlargest</code> does exactly what we might expect, returning the rows with the n largest values according to the provided column(s):</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>starwars.nlargest(<span class="dv">2</span>, <span class="st">'sale_price'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unit</th>
      <th>cost</th>
      <th>sale_price</th>
      <th>percent_of_sales</th>
      <th>average_unit_cost</th>
      <th>profit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>Lightsaber</td>
      <td>4000</td>
      <td>5000</td>
      <td>0.408430</td>
      <td>1750.0</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lightsaber</td>
      <td>100</td>
      <td>4242</td>
      <td>0.346512</td>
      <td>1750.0</td>
      <td>4142</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>But if we mix this with apply and our grouping dataframe, we can get the largest for each group!</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>grouped_starwars.<span class="bu">apply</span>(<span class="kw">lambda</span> df_: df_.nlargest(<span class="dv">2</span>, <span class="st">'sale_price'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="22">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th></th>
      <th>unit</th>
      <th>cost</th>
      <th>sale_price</th>
      <th>percent_of_sales</th>
      <th>average_unit_cost</th>
      <th>profit</th>
    </tr>
    <tr>
      <th>unit</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="2" valign="top">Blaster</th>
      <th>1</th>
      <td>Blaster</td>
      <td>60</td>
      <td>75</td>
      <td>0.449102</td>
      <td>47.333333</td>
      <td>15</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Blaster</td>
      <td>42</td>
      <td>50</td>
      <td>0.299401</td>
      <td>47.333333</td>
      <td>8</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Lightsaber</th>
      <th>4</th>
      <td>Lightsaber</td>
      <td>4000</td>
      <td>5000</td>
      <td>0.408430</td>
      <td>1750.000000</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lightsaber</td>
      <td>100</td>
      <td>4242</td>
      <td>0.346512</td>
      <td>1750.000000</td>
      <td>4142</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">Stick</th>
      <th>9</th>
      <td>Stick</td>
      <td>5</td>
      <td>20</td>
      <td>0.769231</td>
      <td>5.333333</td>
      <td>15</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Stick</td>
      <td>10</td>
      <td>4</td>
      <td>0.153846</td>
      <td>5.333333</td>
      <td>-6</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Note that when apply produces some different sized aggregate than the original dataframe, it tacks on an extra index indicating what the grouper was. We do not always care about this, and can eliminate it in the initial creation of our grouped dataframe via the <code>group_keys</code> argument:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    starwars</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>    .groupby(<span class="st">'unit'</span>, group_keys<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(<span class="kw">lambda</span> df_: df_.nlargest(<span class="dv">2</span>, <span class="st">'sale_price'</span>))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="23">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unit</th>
      <th>cost</th>
      <th>sale_price</th>
      <th>percent_of_sales</th>
      <th>average_unit_cost</th>
      <th>profit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Blaster</td>
      <td>60</td>
      <td>75</td>
      <td>0.449102</td>
      <td>47.333333</td>
      <td>15</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Blaster</td>
      <td>42</td>
      <td>50</td>
      <td>0.299401</td>
      <td>47.333333</td>
      <td>8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Lightsaber</td>
      <td>4000</td>
      <td>5000</td>
      <td>0.408430</td>
      <td>1750.000000</td>
      <td>1000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lightsaber</td>
      <td>100</td>
      <td>4242</td>
      <td>0.346512</td>
      <td>1750.000000</td>
      <td>4142</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Stick</td>
      <td>5</td>
      <td>20</td>
      <td>0.769231</td>
      <td>5.333333</td>
      <td>15</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Stick</td>
      <td>10</td>
      <td>4</td>
      <td>0.153846</td>
      <td>5.333333</td>
      <td>-6</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="ex-4.-create-multiple-columns" class="level4">
<h4 class="anchored" data-anchor-id="ex-4.-create-multiple-columns">Ex 4. Create Multiple Columns</h4>
<p>We can use the dataframe behaviour of apply to create multiple additional columns all at once within an apply. Let’s create a function that will act on each dataframe group, create new values, and return the dataframe.</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_multiple_columns(df_):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    df_[<span class="st">'average_group_profit'</span>] <span class="op">=</span> (df_.sale_price <span class="op">-</span> df_.cost).mean()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>    df_[<span class="st">'profit_relative_to_group'</span>] <span class="op">=</span> df_[<span class="st">'profit'</span>]<span class="op">/</span>df_[<span class="st">'average_group_profit'</span>]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>grouped_starwars.<span class="bu">apply</span>(create_multiple_columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="24">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unit</th>
      <th>cost</th>
      <th>sale_price</th>
      <th>percent_of_sales</th>
      <th>average_unit_cost</th>
      <th>profit</th>
      <th>average_group_profit</th>
      <th>profit_relative_to_group</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Blaster</td>
      <td>42</td>
      <td>50</td>
      <td>0.299401</td>
      <td>47.333333</td>
      <td>8</td>
      <td>8.333333</td>
      <td>0.960000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Blaster</td>
      <td>60</td>
      <td>75</td>
      <td>0.449102</td>
      <td>47.333333</td>
      <td>15</td>
      <td>8.333333</td>
      <td>1.800000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Blaster</td>
      <td>40</td>
      <td>42</td>
      <td>0.251497</td>
      <td>47.333333</td>
      <td>2</td>
      <td>8.333333</td>
      <td>0.240000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Lightsaber</td>
      <td>900</td>
      <td>1000</td>
      <td>0.081686</td>
      <td>1750.000000</td>
      <td>100</td>
      <td>1310.500000</td>
      <td>0.076307</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Lightsaber</td>
      <td>4000</td>
      <td>5000</td>
      <td>0.408430</td>
      <td>1750.000000</td>
      <td>1000</td>
      <td>1310.500000</td>
      <td>0.763068</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Lightsaber</td>
      <td>2000</td>
      <td>2000</td>
      <td>0.163372</td>
      <td>1750.000000</td>
      <td>0</td>
      <td>1310.500000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lightsaber</td>
      <td>100</td>
      <td>4242</td>
      <td>0.346512</td>
      <td>1750.000000</td>
      <td>4142</td>
      <td>1310.500000</td>
      <td>3.160626</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Stick</td>
      <td>10</td>
      <td>4</td>
      <td>0.153846</td>
      <td>5.333333</td>
      <td>-6</td>
      <td>3.333333</td>
      <td>-1.800000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Stick</td>
      <td>1</td>
      <td>2</td>
      <td>0.076923</td>
      <td>5.333333</td>
      <td>1</td>
      <td>3.333333</td>
      <td>0.300000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Stick</td>
      <td>5</td>
      <td>20</td>
      <td>0.769231</td>
      <td>5.333333</td>
      <td>15</td>
      <td>3.333333</td>
      <td>4.500000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p><br> When done this way, we are explicitly returning the dataframe, regardless of if it was grouped or not. Even if all of the new columns are aggregates, this will still produce a non-aggregated output:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_multiple_aggregated_columns(df_):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    df_[<span class="st">'average_group_profit'</span>] <span class="op">=</span> (df_.sale_price <span class="op">-</span> df_.cost).mean()</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    df_[<span class="st">'average_sale_price'</span>] <span class="op">=</span> df_.sale_price.mean()</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>grouped_starwars.<span class="bu">apply</span>(create_multiple_aggregated_columns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="25">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unit</th>
      <th>cost</th>
      <th>sale_price</th>
      <th>percent_of_sales</th>
      <th>average_unit_cost</th>
      <th>profit</th>
      <th>average_group_profit</th>
      <th>average_sale_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Blaster</td>
      <td>42</td>
      <td>50</td>
      <td>0.299401</td>
      <td>47.333333</td>
      <td>8</td>
      <td>8.333333</td>
      <td>55.666667</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Blaster</td>
      <td>60</td>
      <td>75</td>
      <td>0.449102</td>
      <td>47.333333</td>
      <td>15</td>
      <td>8.333333</td>
      <td>55.666667</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Blaster</td>
      <td>40</td>
      <td>42</td>
      <td>0.251497</td>
      <td>47.333333</td>
      <td>2</td>
      <td>8.333333</td>
      <td>55.666667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Lightsaber</td>
      <td>900</td>
      <td>1000</td>
      <td>0.081686</td>
      <td>1750.000000</td>
      <td>100</td>
      <td>1310.500000</td>
      <td>3060.500000</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Lightsaber</td>
      <td>4000</td>
      <td>5000</td>
      <td>0.408430</td>
      <td>1750.000000</td>
      <td>1000</td>
      <td>1310.500000</td>
      <td>3060.500000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Lightsaber</td>
      <td>2000</td>
      <td>2000</td>
      <td>0.163372</td>
      <td>1750.000000</td>
      <td>0</td>
      <td>1310.500000</td>
      <td>3060.500000</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lightsaber</td>
      <td>100</td>
      <td>4242</td>
      <td>0.346512</td>
      <td>1750.000000</td>
      <td>4142</td>
      <td>1310.500000</td>
      <td>3060.500000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Stick</td>
      <td>10</td>
      <td>4</td>
      <td>0.153846</td>
      <td>5.333333</td>
      <td>-6</td>
      <td>3.333333</td>
      <td>8.666667</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Stick</td>
      <td>1</td>
      <td>2</td>
      <td>0.076923</td>
      <td>5.333333</td>
      <td>1</td>
      <td>3.333333</td>
      <td>8.666667</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Stick</td>
      <td>5</td>
      <td>20</td>
      <td>0.769231</td>
      <td>5.333333</td>
      <td>15</td>
      <td>3.333333</td>
      <td>8.666667</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
</section>
<section id="challenge-2" class="level3">
<h3 class="anchored" data-anchor-id="challenge-2">Challenge 2</h3>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge 2
</div>
</div>
<div class="callout-body-container callout-body">
<p>Determine which of the units in each group had the greatest profit, and return a dataframe containing only the rows corresponding to these units.</p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution to Challenge 2
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>There are a variety of different ways this could be approached. We have done a similar question using apply already, so let’s do this via the transform function.</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>condition <span class="op">=</span> starwars.profit <span class="op">==</span> starwars.groupby(<span class="st">'unit'</span>).profit.transform(<span class="st">'max'</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>starwars[condition]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="26">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>unit</th>
      <th>cost</th>
      <th>sale_price</th>
      <th>percent_of_sales</th>
      <th>average_unit_cost</th>
      <th>profit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>Blaster</td>
      <td>60</td>
      <td>75</td>
      <td>0.449102</td>
      <td>47.333333</td>
      <td>15</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Lightsaber</td>
      <td>100</td>
      <td>4242</td>
      <td>0.346512</td>
      <td>1750.000000</td>
      <td>4142</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Stick</td>
      <td>5</td>
      <td>20</td>
      <td>0.769231</td>
      <td>5.333333</td>
      <td>15</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="windowing-functions" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="windowing-functions"><span class="header-section-number">9.3</span> Windowing Functions</h2>
<center>
<img src="images/advanced-pandas/pandas_window.jpg" width="40%" style="margin:auto">
<p style="text-align: center">
</p>
</center>
<p>Often when we are looking at our data, we may have a question about how one value compares to the values around it. This is typically useful for timeseries data, where we can organize our data by date (or year, month, etc). Once sorted on a date, we might wish to know things such as:</p>
<ul>
<li>Did this year have a lower or higher average than the previous year?</li>
<li>What is the roling average over the last 5 years?</li>
</ul>
<p>Or many other comparative questions. We can answer some of these questions using the <strong>windowing</strong> capabilities of Pandas. Windowing is the act of looking at a single ‘window’ of the data, asking our question (what is the average value for the time period in this window?), and then sliding the window to do it again. You have likely heard the term <strong>rolling average</strong> - this is what windowing allows us to calculate.</p>
<section id="rolling" class="level3">
<h3 class="anchored" data-anchor-id="rolling">Rolling</h3>
<p>To calculate a rolling average, we use two methods. First, we indicate that we want rolling statistics by using the <code>rolling()</code> method, and include in the argument the number of periods (rows) to include. After the <code>rolling</code> method, we indicate which aggregation we would like to use. Let’s try this out on a timeseries dataset:</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>dowjones <span class="op">=</span> load_dataset(<span class="st">'dowjones'</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>dowjones.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="27">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Date</th>
      <th>Price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1914-12-01</td>
      <td>55.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1915-01-01</td>
      <td>56.55</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1915-02-01</td>
      <td>56.00</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1915-03-01</td>
      <td>58.30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1915-04-01</td>
      <td>66.45</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This is a monthly aggregate of the Dow Jones index. Let’s compare this monthly aggregate to a 6 month rolling average:</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>dowjones[<span class="st">'six_month_avg'</span>] <span class="op">=</span> dowjones.rolling(<span class="dv">6</span>).Price.mean()</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>dowjones.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Date</th>
      <th>Price</th>
      <th>six_month_avg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1914-12-01</td>
      <td>55.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1915-01-01</td>
      <td>56.55</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1915-02-01</td>
      <td>56.00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1915-03-01</td>
      <td>58.30</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1915-04-01</td>
      <td>66.45</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1915-05-01</td>
      <td>65.95</td>
      <td>59.708333</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1915-06-01</td>
      <td>68.40</td>
      <td>61.941667</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1915-07-01</td>
      <td>71.85</td>
      <td>64.491667</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1915-08-01</td>
      <td>79.25</td>
      <td>68.366667</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1915-09-01</td>
      <td>85.50</td>
      <td>72.900000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Sort your Data!
</div>
</div>
<div class="callout-body-container callout-body">
<p>When using the rolling method this way, it assumes that the data is already sorted in the order you want! The dowjones dataset comes pre-sorted, but this isn’t always the case. Before doing any sort of windowing function, it is always a good idea to pre-sort your data! For the dowjones dataset, we would sort on the Date column:</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>dowjones <span class="op">=</span> dowjones.sort_values(by<span class="op">=</span><span class="st">'Date'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>You’ll notice that for the first 5 months, this method returns <code>NaN</code> - this is because there were not enough values to include in the average, as the method assumes you always wish to have exactly 6 values in each rolling window. We can alter this however, using the <code>min_periods</code> argument:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>dowjones[<span class="st">'six_month_avg'</span>] <span class="op">=</span> dowjones.rolling(<span class="dv">6</span>, min_periods<span class="op">=</span><span class="dv">1</span>).Price.mean()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>dowjones.head(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="30">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Date</th>
      <th>Price</th>
      <th>six_month_avg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1914-12-01</td>
      <td>55.00</td>
      <td>55.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1915-01-01</td>
      <td>56.55</td>
      <td>55.775000</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1915-02-01</td>
      <td>56.00</td>
      <td>55.850000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1915-03-01</td>
      <td>58.30</td>
      <td>56.462500</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1915-04-01</td>
      <td>66.45</td>
      <td>58.460000</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1915-05-01</td>
      <td>65.95</td>
      <td>59.708333</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1915-06-01</td>
      <td>68.40</td>
      <td>61.941667</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1915-07-01</td>
      <td>71.85</td>
      <td>64.491667</td>
    </tr>
    <tr>
      <th>8</th>
      <td>1915-08-01</td>
      <td>79.25</td>
      <td>68.366667</td>
    </tr>
    <tr>
      <th>9</th>
      <td>1915-09-01</td>
      <td>85.50</td>
      <td>72.900000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Let’s see what these rolling averages look like visually:</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add more averages</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>dowjones[<span class="st">'five_year'</span>] <span class="op">=</span> dowjones.rolling(<span class="dv">60</span>, min_periods<span class="op">=</span><span class="dv">1</span>).Price.mean()</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the original data</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>plt.plot(dowjones.Date, dowjones.Price, label<span class="op">=</span><span class="st">'Actual Data'</span>)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the smoothed data</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>plt.plot(dowjones.Date, dowjones.six_month_avg, label<span class="op">=</span><span class="st">'Six Month'</span>)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>plt.plot(dowjones.Date, dowjones.five_year, label<span class="op">=</span><span class="st">'Five Year'</span>)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># add a legend</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="32_advanced_pandas_files/figure-html/cell-32-output-1.png" width="586" height="411"></p>
</div>
</div>
<p>The six month average is starting to smooth out the jagged peaks in the original data, while the five-year average has completely smoothed out all the wiggles!</p>
</section>
<section id="cumulative" class="level3">
<h3 class="anchored" data-anchor-id="cumulative">Cumulative</h3>
<p>While the rolling capabilities will provide us a fixed window into which we can calculate aggregate statistics, we may also wish to calculate cumulative statistics. The most common cumulative statistic is the <strong>cumulative sum</strong>, which calculates the sum of the current row and all preceding rows. In Pandas, we can calculate this with the <code>cumsum</code> method.</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>dowjones[<span class="st">'cumulative_price'</span>] <span class="op">=</span> dowjones.Price.cumsum()</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>dowjones.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Date</th>
      <th>Price</th>
      <th>six_month_avg</th>
      <th>five_year</th>
      <th>cumulative_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1914-12-01</td>
      <td>55.00</td>
      <td>55.0000</td>
      <td>55.0000</td>
      <td>55.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1915-01-01</td>
      <td>56.55</td>
      <td>55.7750</td>
      <td>55.7750</td>
      <td>111.55</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1915-02-01</td>
      <td>56.00</td>
      <td>55.8500</td>
      <td>55.8500</td>
      <td>167.55</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1915-03-01</td>
      <td>58.30</td>
      <td>56.4625</td>
      <td>56.4625</td>
      <td>225.85</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1915-04-01</td>
      <td>66.45</td>
      <td>58.4600</td>
      <td>58.4600</td>
      <td>292.30</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="shifts" class="level3">
<h3 class="anchored" data-anchor-id="shifts">Shifts</h3>
<p>Finally, knowing the value preceding or following the current value is sometimes of interest. Forecast modeling will often use the current value and past values to predict future values, for example. To retrieve <strong>lead</strong> and <strong>lag</strong> values, Pandas has the <code>shift</code> method. This takes as an argument the number of periods by which we wish to shift our dataset (defaulting to 1). The periods can be negative, letting us get future values as well! Let’s look at this with the dowjones dataset again:</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>dowjones[<span class="st">'year_prior'</span>] <span class="op">=</span> dowjones.Price.shift(<span class="dv">12</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>dowjones[<span class="st">'year_after'</span>] <span class="op">=</span> dowjones.Price.shift(<span class="op">-</span><span class="dv">12</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>dowjones.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Date</th>
      <th>Price</th>
      <th>six_month_avg</th>
      <th>five_year</th>
      <th>cumulative_price</th>
      <th>year_prior</th>
      <th>year_after</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1914-12-01</td>
      <td>55.00</td>
      <td>55.0000</td>
      <td>55.0000</td>
      <td>55.00</td>
      <td>NaN</td>
      <td>97.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1915-01-01</td>
      <td>56.55</td>
      <td>55.7750</td>
      <td>55.7750</td>
      <td>111.55</td>
      <td>NaN</td>
      <td>94.70</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1915-02-01</td>
      <td>56.00</td>
      <td>55.8500</td>
      <td>55.8500</td>
      <td>167.55</td>
      <td>NaN</td>
      <td>93.55</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1915-03-01</td>
      <td>58.30</td>
      <td>56.4625</td>
      <td>56.4625</td>
      <td>225.85</td>
      <td>NaN</td>
      <td>93.30</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1915-04-01</td>
      <td>66.45</td>
      <td>58.4600</td>
      <td>58.4600</td>
      <td>292.30</td>
      <td>NaN</td>
      <td>89.75</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>To show that this is actually the year before and after, let’s filter to a year somewhere in the middle.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Advanced Tip: Date Columns
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>In order to filter to the middle year, we need to be sure of the type of data we are working with. Let’s take a quick look at the Date column, and see what the datatype is:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(dowjones.Date.dtype)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>datetime64[ns]</code></pre>
</div>
</div>
<p>This is a new column type that we have not encountered in detail before, but it tells us that this column contains date information. If we were to look at a single value in the Series, we would see that it is not simply a ‘YYYY-MM-DD’ string as displayed when we view the dataframe:</p>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>single_date <span class="op">=</span> dowjones.Date[<span class="dv">0</span>]</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(single_date)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">type</span>(single_date))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1914-12-01 00:00:00
&lt;class 'pandas._libs.tslibs.timestamps.Timestamp'&gt;</code></pre>
</div>
</div>
<p>Because this is not a string, we cannot do a simple string comparison between two dates:</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(single_date <span class="op">==</span> <span class="st">'1914-12-01'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>False</code></pre>
</div>
</div>
<p>To filter based on date columns then, we should instead create a date type object in Python. The easiest way to do that is using the built in python library <code>datetime</code>.</p>
<div class="cell" data-execution_count="37">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create a date-like object</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>new_date <span class="op">=</span> datetime(<span class="dv">1914</span>, <span class="dv">12</span>, <span class="dv">1</span>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(new_date)</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co"># compare with the single date</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(single_date <span class="op">==</span> new_date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1914-12-01 00:00:00
True</code></pre>
</div>
</div>
<p>For more information on dates in Pandas, see the <a href="https://pandas.pydata.org/docs/user_guide/timeseries.html">time series/date functionality</a> page for Pandas, and the <a href="https://numpy.org/doc/stable/reference/arrays.datetime.html">numpy documentation for datetime64</a>.</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># create dates for the filter</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>current_year <span class="op">=</span> datetime(<span class="dv">1942</span>, <span class="dv">8</span>, <span class="dv">1</span>)</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>previous_year <span class="op">=</span> datetime(<span class="dv">1941</span>, <span class="dv">8</span>, <span class="dv">1</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>next_year <span class="op">=</span> datetime(<span class="dv">1943</span>, <span class="dv">8</span>, <span class="dv">1</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co"># filter the date column</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>dowjones[</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    dowjones.Date.isin([current_year, previous_year, next_year])</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>][</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'Date'</span>, <span class="st">'Price'</span>, <span class="st">'year_prior'</span>, <span class="st">'year_after'</span>]</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="38">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Date</th>
      <th>Price</th>
      <th>year_prior</th>
      <th>year_after</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>320</th>
      <td>1941-08-01</td>
      <td>126.55</td>
      <td>125.35</td>
      <td>106.20</td>
    </tr>
    <tr>
      <th>332</th>
      <td>1942-08-01</td>
      <td>106.20</td>
      <td>126.55</td>
      <td>136.22</td>
    </tr>
    <tr>
      <th>344</th>
      <td>1943-08-01</td>
      <td>136.22</td>
      <td>106.20</td>
      <td>146.93</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>If we look at these three lines, we see that the <code>year_prior</code> and <code>year_after</code> columns do in fact give us the corresponding values from the initial dataset. And if we plot this, we will see three copies of the data, each shifted by a year:</p>
<div class="cell" data-execution_count="39">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>plt.plot(dowjones.Date, dowjones.year_prior, label<span class="op">=</span><span class="st">'past'</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>plt.plot(dowjones.Date, dowjones.Price, label<span class="op">=</span><span class="st">'current'</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>plt.plot(dowjones.Date, dowjones.year_after, label<span class="op">=</span><span class="st">'future'</span>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="32_advanced_pandas_files/figure-html/cell-40-output-1.png" width="586" height="411"></p>
</div>
</div>
</section>
<section id="challenge-3" class="level3">
<h3 class="anchored" data-anchor-id="challenge-3">Challenge 3</h3>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge 3
</div>
</div>
<div class="callout-body-container callout-body">
<p>Find the average, minimum, and maximum Dow Jones prices on a yearly basis. Plot all three values to see how they compare! (Recall: this dataset is currently <em>monthly</em>)</p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution to Challenge 3
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell" data-execution_count="40">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first let's find the three aggregations we want</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>dowjones_rolling <span class="op">=</span> dowjones.rolling(<span class="dv">12</span>, min_periods<span class="op">=</span><span class="dv">1</span>).agg(</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    {<span class="st">'Price'</span>: [<span class="st">'min'</span>, <span class="st">'max'</span>, <span class="st">'mean'</span>]}</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>display(dowjones_rolling.head())</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co"># get rid of hierarchical naming scheme</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>dowjones_rolling.columns <span class="op">=</span> [<span class="st">'price_min'</span>, <span class="st">'price_max'</span>, <span class="st">'price_mean'</span>]</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot these (note that this DF doesn't have the dates, so we use the old DF dates)</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co"># here's a fancy plot that will show a coloured band!</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>plt.fill_between(</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    dowjones.Date, </span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    dowjones_rolling.price_min, </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>    dowjones_rolling.price_max, </span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.3</span> <span class="co"># alpha makes the band more transparent</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>plt.plot(dowjones.Date, dowjones_rolling.price_mean)</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">Price</th>
    </tr>
    <tr>
      <th></th>
      <th>min</th>
      <th>max</th>
      <th>mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>55.0</td>
      <td>55.00</td>
      <td>55.0000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>55.0</td>
      <td>56.55</td>
      <td>55.7750</td>
    </tr>
    <tr>
      <th>2</th>
      <td>55.0</td>
      <td>56.55</td>
      <td>55.8500</td>
    </tr>
    <tr>
      <th>3</th>
      <td>55.0</td>
      <td>58.30</td>
      <td>56.4625</td>
    </tr>
    <tr>
      <th>4</th>
      <td>55.0</td>
      <td>66.45</td>
      <td>58.4600</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<p><img src="32_advanced_pandas_files/figure-html/cell-41-output-2.png" width="586" height="411"></p>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="reshaping-data" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="reshaping-data"><span class="header-section-number">9.4</span> Reshaping Data</h2>
<center>
<img src="images/advanced-pandas/wide_vs_long.png" width="60%" style="margin:auto">
<p style="text-align: center">
Wide or Long?
</p>
</center>
<p>Another fairly common task in data analysis is pivoting our data. Typically this means we are creating a <strong>wide-form</strong> table that has more columns than originally. This may be near the end of a particular analysis and we want to prepare a final table for a report, or perhaps we wish to pick out specific values from a column for more detailed inspection. Another common use of a pivot table might be for timeseries data, and we wish to separate different variables into their own individual columns. In these cases, we can use the <code>pivot</code> and <code>pivot_table</code> methods within Pandas.</p>
<p>In the other direction, we may wish to ‘unpivot’ a dataset. This will often occur early on in an analysis, where we wish to create a <strong>long-form</strong> table where multiple columns have been combined into a single set of id and value columns. This will be done with the <code>melt</code> method.</p>
<p>Let’s explore these ideas with the gapminder dataset.</p>
<div class="cell" data-execution_count="41">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/bcgov/"</span>\</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ds-intro-to-python/main/data/gapfinder.csv"</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>gapminder <span class="op">=</span> pd.read_csv(url)</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>gapminder.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="41">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1952</td>
      <td>8425333.0</td>
      <td>Asia</td>
      <td>28.801</td>
      <td>779.445314</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1957</td>
      <td>9240934.0</td>
      <td>Asia</td>
      <td>30.332</td>
      <td>820.853030</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>1962</td>
      <td>10267083.0</td>
      <td>Asia</td>
      <td>31.997</td>
      <td>853.100710</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>1967</td>
      <td>11537966.0</td>
      <td>Asia</td>
      <td>34.020</td>
      <td>836.197138</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>1972</td>
      <td>13079460.0</td>
      <td>Asia</td>
      <td>36.088</td>
      <td>739.981106</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="long-to-wide" class="level3">
<h3 class="anchored" data-anchor-id="long-to-wide">Long to Wide</h3>
<center>
<img src="images/advanced-pandas/reshaping_pivot.png" width="60%" style="margin:auto">
<p style="text-align: center">
Pivoting a Table
</p>
</center>
<section id="pivot" class="level4">
<h4 class="anchored" data-anchor-id="pivot">pivot</h4>
<p>The first thing we may wish to do is a simple pivot in which we make the table <em>wider</em> than it was before. The simplest way to do this is by the <code>pivot</code> method. This takes as input three arguments:</p>
<ul>
<li><code>columns</code>: the only <strong>required</strong> argument! Column(s) we wish to use for the new columns of our dataframe. If more than one is provided, a hierarchy of columns is created.</li>
<li><code>index</code>: the column(s) we wish to use for the index of our new dataframe. This is entirely optional, and will just default to the pre-existing index if not supplied.</li>
<li><code>values</code>: the value(s) we wish to retain for the new dataframe. This is also optional, and will use all leftover columns if nothing is provided. If more than one column is used here, it again creates a hierarchy in the columns.</li>
</ul>
<p>The output of the <code>pivot</code> method is a new dataframe that has the requested index/columns, with the corresponding value associated with each index-column pair in the dataframe.</p>
<p>For instance, perhaps we wish to explore the population of each country individually overtime. In this case, we can pivot our gapminder dataset so that each of the countries in the original country column become their own column, and compare the population value against the year:</p>
<div class="cell" data-execution_count="42">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>gapminder_year_country <span class="op">=</span> gapminder.pivot(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'country'</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'pop'</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>gapminder_year_country.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="42">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>country</th>
      <th>Afghanistan</th>
      <th>Albania</th>
      <th>Algeria</th>
      <th>Angola</th>
      <th>Argentina</th>
      <th>Australia</th>
      <th>Austria</th>
      <th>Bahrain</th>
      <th>Bangladesh</th>
      <th>Belgium</th>
      <th>...</th>
      <th>Uganda</th>
      <th>United Kingdom</th>
      <th>United States</th>
      <th>Uruguay</th>
      <th>Venezuela</th>
      <th>Vietnam</th>
      <th>West Bank and Gaza</th>
      <th>Yemen Rep.</th>
      <th>Zambia</th>
      <th>Zimbabwe</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1952</th>
      <td>8425333.0</td>
      <td>1282697.0</td>
      <td>9279525.0</td>
      <td>4232095.0</td>
      <td>17876956.0</td>
      <td>8691212.0</td>
      <td>6927772.0</td>
      <td>120447.0</td>
      <td>46886859.0</td>
      <td>8730405.0</td>
      <td>...</td>
      <td>5824797.0</td>
      <td>50430000.0</td>
      <td>157553000.0</td>
      <td>2252965.0</td>
      <td>5439568.0</td>
      <td>26246839.0</td>
      <td>1030585.0</td>
      <td>4963829.0</td>
      <td>2672000.0</td>
      <td>3080907.0</td>
    </tr>
    <tr>
      <th>1957</th>
      <td>9240934.0</td>
      <td>1476505.0</td>
      <td>10270856.0</td>
      <td>4561361.0</td>
      <td>19610538.0</td>
      <td>9712569.0</td>
      <td>6965860.0</td>
      <td>138655.0</td>
      <td>51365468.0</td>
      <td>8989111.0</td>
      <td>...</td>
      <td>6675501.0</td>
      <td>51430000.0</td>
      <td>171984000.0</td>
      <td>2424959.0</td>
      <td>6702668.0</td>
      <td>28998543.0</td>
      <td>1070439.0</td>
      <td>5498090.0</td>
      <td>3016000.0</td>
      <td>3646340.0</td>
    </tr>
    <tr>
      <th>1962</th>
      <td>10267083.0</td>
      <td>1728137.0</td>
      <td>11000948.0</td>
      <td>4826015.0</td>
      <td>21283783.0</td>
      <td>10794968.0</td>
      <td>7129864.0</td>
      <td>171863.0</td>
      <td>56839289.0</td>
      <td>9218400.0</td>
      <td>...</td>
      <td>7688797.0</td>
      <td>53292000.0</td>
      <td>186538000.0</td>
      <td>2598466.0</td>
      <td>8143375.0</td>
      <td>33796140.0</td>
      <td>1133134.0</td>
      <td>6120081.0</td>
      <td>3421000.0</td>
      <td>4277736.0</td>
    </tr>
    <tr>
      <th>1967</th>
      <td>11537966.0</td>
      <td>1984060.0</td>
      <td>12760499.0</td>
      <td>5247469.0</td>
      <td>22934225.0</td>
      <td>11872264.0</td>
      <td>7376998.0</td>
      <td>202182.0</td>
      <td>62821884.0</td>
      <td>9556500.0</td>
      <td>...</td>
      <td>8900294.0</td>
      <td>54959000.0</td>
      <td>198712000.0</td>
      <td>2748579.0</td>
      <td>9709552.0</td>
      <td>39463910.0</td>
      <td>1142636.0</td>
      <td>6740785.0</td>
      <td>3900000.0</td>
      <td>4995432.0</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>13079460.0</td>
      <td>2263554.0</td>
      <td>14760787.0</td>
      <td>5894858.0</td>
      <td>24779799.0</td>
      <td>13177000.0</td>
      <td>7544201.0</td>
      <td>230800.0</td>
      <td>70759295.0</td>
      <td>9709100.0</td>
      <td>...</td>
      <td>10190285.0</td>
      <td>56079000.0</td>
      <td>209896000.0</td>
      <td>2829526.0</td>
      <td>11515649.0</td>
      <td>44655014.0</td>
      <td>1089572.0</td>
      <td>7407075.0</td>
      <td>4506497.0</td>
      <td>5861135.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 142 columns</p>
</div>
</div>
</div>
<p>Note that doing this moves ‘year’ into the index of the dataframe, and gives the columns the name of ‘country’. We can move ‘year’ back into the core of the dataframe using <code>reset_index()</code>, and remove the column name using the <code>name</code> attribute of the <code>columns</code>:</p>
<div class="cell" data-execution_count="43">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>gapminder_year_country <span class="op">=</span> gapminder_year_country.reset_index()</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>gapminder_year_country.columns.name <span class="op">=</span> <span class="va">None</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>gapminder_year_country.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="43">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>year</th>
      <th>Afghanistan</th>
      <th>Albania</th>
      <th>Algeria</th>
      <th>Angola</th>
      <th>Argentina</th>
      <th>Australia</th>
      <th>Austria</th>
      <th>Bahrain</th>
      <th>Bangladesh</th>
      <th>...</th>
      <th>Uganda</th>
      <th>United Kingdom</th>
      <th>United States</th>
      <th>Uruguay</th>
      <th>Venezuela</th>
      <th>Vietnam</th>
      <th>West Bank and Gaza</th>
      <th>Yemen Rep.</th>
      <th>Zambia</th>
      <th>Zimbabwe</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1952</td>
      <td>8425333.0</td>
      <td>1282697.0</td>
      <td>9279525.0</td>
      <td>4232095.0</td>
      <td>17876956.0</td>
      <td>8691212.0</td>
      <td>6927772.0</td>
      <td>120447.0</td>
      <td>46886859.0</td>
      <td>...</td>
      <td>5824797.0</td>
      <td>50430000.0</td>
      <td>157553000.0</td>
      <td>2252965.0</td>
      <td>5439568.0</td>
      <td>26246839.0</td>
      <td>1030585.0</td>
      <td>4963829.0</td>
      <td>2672000.0</td>
      <td>3080907.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1957</td>
      <td>9240934.0</td>
      <td>1476505.0</td>
      <td>10270856.0</td>
      <td>4561361.0</td>
      <td>19610538.0</td>
      <td>9712569.0</td>
      <td>6965860.0</td>
      <td>138655.0</td>
      <td>51365468.0</td>
      <td>...</td>
      <td>6675501.0</td>
      <td>51430000.0</td>
      <td>171984000.0</td>
      <td>2424959.0</td>
      <td>6702668.0</td>
      <td>28998543.0</td>
      <td>1070439.0</td>
      <td>5498090.0</td>
      <td>3016000.0</td>
      <td>3646340.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1962</td>
      <td>10267083.0</td>
      <td>1728137.0</td>
      <td>11000948.0</td>
      <td>4826015.0</td>
      <td>21283783.0</td>
      <td>10794968.0</td>
      <td>7129864.0</td>
      <td>171863.0</td>
      <td>56839289.0</td>
      <td>...</td>
      <td>7688797.0</td>
      <td>53292000.0</td>
      <td>186538000.0</td>
      <td>2598466.0</td>
      <td>8143375.0</td>
      <td>33796140.0</td>
      <td>1133134.0</td>
      <td>6120081.0</td>
      <td>3421000.0</td>
      <td>4277736.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1967</td>
      <td>11537966.0</td>
      <td>1984060.0</td>
      <td>12760499.0</td>
      <td>5247469.0</td>
      <td>22934225.0</td>
      <td>11872264.0</td>
      <td>7376998.0</td>
      <td>202182.0</td>
      <td>62821884.0</td>
      <td>...</td>
      <td>8900294.0</td>
      <td>54959000.0</td>
      <td>198712000.0</td>
      <td>2748579.0</td>
      <td>9709552.0</td>
      <td>39463910.0</td>
      <td>1142636.0</td>
      <td>6740785.0</td>
      <td>3900000.0</td>
      <td>4995432.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1972</td>
      <td>13079460.0</td>
      <td>2263554.0</td>
      <td>14760787.0</td>
      <td>5894858.0</td>
      <td>24779799.0</td>
      <td>13177000.0</td>
      <td>7544201.0</td>
      <td>230800.0</td>
      <td>70759295.0</td>
      <td>...</td>
      <td>10190285.0</td>
      <td>56079000.0</td>
      <td>209896000.0</td>
      <td>2829526.0</td>
      <td>11515649.0</td>
      <td>44655014.0</td>
      <td>1089572.0</td>
      <td>7407075.0</td>
      <td>4506497.0</td>
      <td>5861135.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 143 columns</p>
</div>
</div>
</div>
<p>We could make a slightly more complex dataset by including the continent as well in our new column scheme:</p>
<div class="cell" data-execution_count="44">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>gapminder_year_country_continent <span class="op">=</span> gapminder.pivot(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>[<span class="st">'country'</span>, <span class="st">'continent'</span>],</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'pop'</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>gapminder_year_country_continent.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="44">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>country</th>
      <th>Afghanistan</th>
      <th>Albania</th>
      <th>Algeria</th>
      <th>Angola</th>
      <th>Argentina</th>
      <th>Australia</th>
      <th>Austria</th>
      <th>Bahrain</th>
      <th>Bangladesh</th>
      <th>Belgium</th>
      <th>...</th>
      <th>Uganda</th>
      <th>United Kingdom</th>
      <th>United States</th>
      <th>Uruguay</th>
      <th>Venezuela</th>
      <th>Vietnam</th>
      <th>West Bank and Gaza</th>
      <th>Yemen Rep.</th>
      <th>Zambia</th>
      <th>Zimbabwe</th>
    </tr>
    <tr>
      <th>continent</th>
      <th>Asia</th>
      <th>Europe</th>
      <th>Africa</th>
      <th>Africa</th>
      <th>Americas</th>
      <th>Oceania</th>
      <th>Europe</th>
      <th>Asia</th>
      <th>Asia</th>
      <th>Europe</th>
      <th>...</th>
      <th>Africa</th>
      <th>Europe</th>
      <th>Americas</th>
      <th>Americas</th>
      <th>Americas</th>
      <th>Asia</th>
      <th>Asia</th>
      <th>Asia</th>
      <th>Africa</th>
      <th>Africa</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1952</th>
      <td>8425333.0</td>
      <td>1282697.0</td>
      <td>9279525.0</td>
      <td>4232095.0</td>
      <td>17876956.0</td>
      <td>8691212.0</td>
      <td>6927772.0</td>
      <td>120447.0</td>
      <td>46886859.0</td>
      <td>8730405.0</td>
      <td>...</td>
      <td>5824797.0</td>
      <td>50430000.0</td>
      <td>157553000.0</td>
      <td>2252965.0</td>
      <td>5439568.0</td>
      <td>26246839.0</td>
      <td>1030585.0</td>
      <td>4963829.0</td>
      <td>2672000.0</td>
      <td>3080907.0</td>
    </tr>
    <tr>
      <th>1957</th>
      <td>9240934.0</td>
      <td>1476505.0</td>
      <td>10270856.0</td>
      <td>4561361.0</td>
      <td>19610538.0</td>
      <td>9712569.0</td>
      <td>6965860.0</td>
      <td>138655.0</td>
      <td>51365468.0</td>
      <td>8989111.0</td>
      <td>...</td>
      <td>6675501.0</td>
      <td>51430000.0</td>
      <td>171984000.0</td>
      <td>2424959.0</td>
      <td>6702668.0</td>
      <td>28998543.0</td>
      <td>1070439.0</td>
      <td>5498090.0</td>
      <td>3016000.0</td>
      <td>3646340.0</td>
    </tr>
    <tr>
      <th>1962</th>
      <td>10267083.0</td>
      <td>1728137.0</td>
      <td>11000948.0</td>
      <td>4826015.0</td>
      <td>21283783.0</td>
      <td>10794968.0</td>
      <td>7129864.0</td>
      <td>171863.0</td>
      <td>56839289.0</td>
      <td>9218400.0</td>
      <td>...</td>
      <td>7688797.0</td>
      <td>53292000.0</td>
      <td>186538000.0</td>
      <td>2598466.0</td>
      <td>8143375.0</td>
      <td>33796140.0</td>
      <td>1133134.0</td>
      <td>6120081.0</td>
      <td>3421000.0</td>
      <td>4277736.0</td>
    </tr>
    <tr>
      <th>1967</th>
      <td>11537966.0</td>
      <td>1984060.0</td>
      <td>12760499.0</td>
      <td>5247469.0</td>
      <td>22934225.0</td>
      <td>11872264.0</td>
      <td>7376998.0</td>
      <td>202182.0</td>
      <td>62821884.0</td>
      <td>9556500.0</td>
      <td>...</td>
      <td>8900294.0</td>
      <td>54959000.0</td>
      <td>198712000.0</td>
      <td>2748579.0</td>
      <td>9709552.0</td>
      <td>39463910.0</td>
      <td>1142636.0</td>
      <td>6740785.0</td>
      <td>3900000.0</td>
      <td>4995432.0</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>13079460.0</td>
      <td>2263554.0</td>
      <td>14760787.0</td>
      <td>5894858.0</td>
      <td>24779799.0</td>
      <td>13177000.0</td>
      <td>7544201.0</td>
      <td>230800.0</td>
      <td>70759295.0</td>
      <td>9709100.0</td>
      <td>...</td>
      <td>10190285.0</td>
      <td>56079000.0</td>
      <td>209896000.0</td>
      <td>2829526.0</td>
      <td>11515649.0</td>
      <td>44655014.0</td>
      <td>1089572.0</td>
      <td>7407075.0</td>
      <td>4506497.0</td>
      <td>5861135.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 142 columns</p>
</div>
</div>
</div>
<p>Or by insisting that we retain information about more than just the population:</p>
<div class="cell" data-execution_count="45">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>gapminder_year_country_two_vals <span class="op">=</span> gapminder.pivot(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'country'</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span>[<span class="st">'pop'</span>, <span class="st">'lifeExp'</span>]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>gapminder_year_country_two_vals.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="45">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="10" halign="left">pop</th>
      <th>...</th>
      <th colspan="10" halign="left">lifeExp</th>
    </tr>
    <tr>
      <th>country</th>
      <th>Afghanistan</th>
      <th>Albania</th>
      <th>Algeria</th>
      <th>Angola</th>
      <th>Argentina</th>
      <th>Australia</th>
      <th>Austria</th>
      <th>Bahrain</th>
      <th>Bangladesh</th>
      <th>Belgium</th>
      <th>...</th>
      <th>Uganda</th>
      <th>United Kingdom</th>
      <th>United States</th>
      <th>Uruguay</th>
      <th>Venezuela</th>
      <th>Vietnam</th>
      <th>West Bank and Gaza</th>
      <th>Yemen Rep.</th>
      <th>Zambia</th>
      <th>Zimbabwe</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1952</th>
      <td>8425333.0</td>
      <td>1282697.0</td>
      <td>9279525.0</td>
      <td>4232095.0</td>
      <td>17876956.0</td>
      <td>8691212.0</td>
      <td>6927772.0</td>
      <td>120447.0</td>
      <td>46886859.0</td>
      <td>8730405.0</td>
      <td>...</td>
      <td>39.978</td>
      <td>69.18</td>
      <td>68.44</td>
      <td>66.071</td>
      <td>55.088</td>
      <td>40.412</td>
      <td>43.160</td>
      <td>32.548</td>
      <td>42.038</td>
      <td>48.451</td>
    </tr>
    <tr>
      <th>1957</th>
      <td>9240934.0</td>
      <td>1476505.0</td>
      <td>10270856.0</td>
      <td>4561361.0</td>
      <td>19610538.0</td>
      <td>9712569.0</td>
      <td>6965860.0</td>
      <td>138655.0</td>
      <td>51365468.0</td>
      <td>8989111.0</td>
      <td>...</td>
      <td>42.571</td>
      <td>70.42</td>
      <td>69.49</td>
      <td>67.044</td>
      <td>57.907</td>
      <td>42.887</td>
      <td>45.671</td>
      <td>33.970</td>
      <td>44.077</td>
      <td>50.469</td>
    </tr>
    <tr>
      <th>1962</th>
      <td>10267083.0</td>
      <td>1728137.0</td>
      <td>11000948.0</td>
      <td>4826015.0</td>
      <td>21283783.0</td>
      <td>10794968.0</td>
      <td>7129864.0</td>
      <td>171863.0</td>
      <td>56839289.0</td>
      <td>9218400.0</td>
      <td>...</td>
      <td>45.344</td>
      <td>70.76</td>
      <td>70.21</td>
      <td>68.253</td>
      <td>60.770</td>
      <td>45.363</td>
      <td>48.127</td>
      <td>35.180</td>
      <td>46.023</td>
      <td>52.358</td>
    </tr>
    <tr>
      <th>1967</th>
      <td>11537966.0</td>
      <td>1984060.0</td>
      <td>12760499.0</td>
      <td>5247469.0</td>
      <td>22934225.0</td>
      <td>11872264.0</td>
      <td>7376998.0</td>
      <td>202182.0</td>
      <td>62821884.0</td>
      <td>9556500.0</td>
      <td>...</td>
      <td>48.051</td>
      <td>71.36</td>
      <td>70.76</td>
      <td>68.468</td>
      <td>63.479</td>
      <td>47.838</td>
      <td>51.631</td>
      <td>36.984</td>
      <td>47.768</td>
      <td>53.995</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>13079460.0</td>
      <td>2263554.0</td>
      <td>14760787.0</td>
      <td>5894858.0</td>
      <td>24779799.0</td>
      <td>13177000.0</td>
      <td>7544201.0</td>
      <td>230800.0</td>
      <td>70759295.0</td>
      <td>9709100.0</td>
      <td>...</td>
      <td>51.016</td>
      <td>72.01</td>
      <td>71.34</td>
      <td>68.673</td>
      <td>65.712</td>
      <td>50.254</td>
      <td>56.532</td>
      <td>39.848</td>
      <td>50.107</td>
      <td>55.635</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 284 columns</p>
</div>
</div>
</div>
<p>What if we wish to know about the average population of each continent over time? If we try the same approach as above, we will immediately run into an issue:</p>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>gapminder_year_continent <span class="op">=</span> gapminder.pivot(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'continent'</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'pop'</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>ValueError: Index contains duplicate entries, cannot reshape</code></pre>
</div>
</div>
<p>Here we find that there is more than one value associated with each year-continent pairing, and so the <code>pivot</code> method does not know how to assign a value to the dataframe. This is because <code>pivot</code> is for unique values only. While it is an excellent simple-use tool, we can go one step further to deal with non-unique values.</p>
</section>
<section id="pivot_table" class="level4">
<h4 class="anchored" data-anchor-id="pivot_table">pivot_table</h4>
<p>To address the year-continent question above, we could first group our data by continent, calculate the average population every year, and then pivot the resultant dataframe. This is a completely valid method! However, pandas also offers a built in method that will do aggregations and pivots all at once. This is similar to the functionality of Excel pivot tables, and includes some additional functionality we would not find in groupby alone. Some of the important arguments that we can use in the <code>pivot_table</code> method include:</p>
<ul>
<li><code>columns</code>: the only <strong>required</strong> argument! Column(s) (and values within) we wish to use for the resultant dataframes columns.</li>
<li><code>values</code>: the column(s) we wish to aggregate. If no columns are provided, all leftover (non column/index columns) columns will be used that make ‘sense’. For example, the average value of a list of strings does not make sense, but the ‘max’ value of a string list could be calculated.</li>
<li><code>index</code>: the column(s) we wish to use for the resultant dataframes index</li>
<li><code>aggfunc</code>: the method of aggregation we wish to use. Default is to calculate the average.</li>
<li><code>fill_value</code>: the value to replace missing values with (after aggregation).</li>
</ul>
<p>Let’s go through some examples with increasing complexity. The simplest thing we can do is pivot a single column, to which we will get an output for the averages of all numerical columns.</p>
<div class="cell" data-execution_count="47">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>gapminder.pivot_table(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'continent'</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="47">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>continent</th>
      <th>Africa</th>
      <th>Americas</th>
      <th>Asia</th>
      <th>Europe</th>
      <th>Oceania</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>gdpPercap</th>
      <td>2.193755e+03</td>
      <td>7.136110e+03</td>
      <td>7.902150e+03</td>
      <td>1.446948e+04</td>
      <td>1.862161e+04</td>
    </tr>
    <tr>
      <th>lifeExp</th>
      <td>4.886533e+01</td>
      <td>6.465874e+01</td>
      <td>6.006490e+01</td>
      <td>7.190369e+01</td>
      <td>7.432621e+01</td>
    </tr>
    <tr>
      <th>pop</th>
      <td>9.916003e+06</td>
      <td>2.450479e+07</td>
      <td>7.703872e+07</td>
      <td>1.716976e+07</td>
      <td>8.874672e+06</td>
    </tr>
    <tr>
      <th>year</th>
      <td>1.979500e+03</td>
      <td>1.979500e+03</td>
      <td>1.979500e+03</td>
      <td>1.979500e+03</td>
      <td>1.979500e+03</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Next we may wish to add an index, and focus on a single value for our output. This matches the question we asked above and could not answer with the <code>pivot</code> method:</p>
<div class="cell" data-execution_count="48">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>gapminder_year_continent <span class="op">=</span> gapminder.pivot_table(</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'continent'</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'pop'</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>gapminder_year_continent.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="48">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>continent</th>
      <th>Africa</th>
      <th>Americas</th>
      <th>Asia</th>
      <th>Europe</th>
      <th>Oceania</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1952</th>
      <td>4.570010e+06</td>
      <td>13806097.84</td>
      <td>4.228356e+07</td>
      <td>1.393736e+07</td>
      <td>5343003.0</td>
    </tr>
    <tr>
      <th>1957</th>
      <td>5.093033e+06</td>
      <td>15478156.64</td>
      <td>4.735699e+07</td>
      <td>1.459635e+07</td>
      <td>5970988.0</td>
    </tr>
    <tr>
      <th>1962</th>
      <td>5.702247e+06</td>
      <td>17330810.16</td>
      <td>5.140476e+07</td>
      <td>1.534517e+07</td>
      <td>6641759.0</td>
    </tr>
    <tr>
      <th>1967</th>
      <td>6.447875e+06</td>
      <td>19229864.92</td>
      <td>5.774736e+07</td>
      <td>1.603930e+07</td>
      <td>7300207.0</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>7.305376e+06</td>
      <td>21175368.40</td>
      <td>6.518098e+07</td>
      <td>1.668784e+07</td>
      <td>8053050.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>If we tried to do the same calculation, but use a string column instead of a numerical column for the values we will get a warning about trying to use invalid columns:</p>
<div class="cell" data-execution_count="49">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>gapminder_year_continent_country <span class="op">=</span> gapminder.pivot_table(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'continent'</span>,</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'country'</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>gapminder_year_continent_country.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_2473/2473994706.py:1: FutureWarning: Dropping invalid columns in DataFrameGroupBy.mean is deprecated. In a future version, a TypeError will be raised. Before calling .mean, select only columns which should be valid for the function.
  gapminder_year_continent_country = gapminder.pivot_table(</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="49">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>continent</th>
    </tr>
    <tr>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1952</th>
    </tr>
    <tr>
      <th>1957</th>
    </tr>
    <tr>
      <th>1962</th>
    </tr>
    <tr>
      <th>1967</th>
    </tr>
    <tr>
      <th>1972</th>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>However, we can switch our aggregation method to something that is valid for strings (using either string arguments for common aggregations such as ‘max’, or more complicated <code>numpy</code> or user-defined functions as well).</p>
<div class="cell" data-execution_count="50">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>gapminder_year_continent_country <span class="op">=</span> gapminder.pivot_table(</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'continent'</span>,</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'country'</span>,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span><span class="st">'max'</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>gapminder_year_continent_country.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="50">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>continent</th>
      <th>Africa</th>
      <th>Americas</th>
      <th>Asia</th>
      <th>Europe</th>
      <th>Oceania</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1952</th>
      <td>Zimbabwe</td>
      <td>Venezuela</td>
      <td>Yemen Rep.</td>
      <td>United Kingdom</td>
      <td>New Zealand</td>
    </tr>
    <tr>
      <th>1957</th>
      <td>Zimbabwe</td>
      <td>Venezuela</td>
      <td>Yemen Rep.</td>
      <td>United Kingdom</td>
      <td>New Zealand</td>
    </tr>
    <tr>
      <th>1962</th>
      <td>Zimbabwe</td>
      <td>Venezuela</td>
      <td>Yemen Rep.</td>
      <td>United Kingdom</td>
      <td>New Zealand</td>
    </tr>
    <tr>
      <th>1967</th>
      <td>Zimbabwe</td>
      <td>Venezuela</td>
      <td>Yemen Rep.</td>
      <td>United Kingdom</td>
      <td>New Zealand</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>Zimbabwe</td>
      <td>Venezuela</td>
      <td>Yemen Rep.</td>
      <td>United Kingdom</td>
      <td>New Zealand</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Finally, similar to our groupby aggregations, we can also pass a dictionary to <code>aggfunc</code>. The dictionary contains the columns we wish to use for values as keys, and the type of aggregation(s) we wish to do as the values.</p>
<div class="cell" data-execution_count="51">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>gapminder_multiple_pivots <span class="op">=</span> gapminder.pivot_table(</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'continent'</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span>{</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>        <span class="st">'pop'</span>: [np.mean, np.<span class="bu">max</span>],</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'lifeExp'</span>: <span class="st">'mean'</span>,</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'country'</span>: [<span class="bu">min</span>, <span class="bu">max</span>]</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>gapminder_multiple_pivots.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="51">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th colspan="10" halign="left">country</th>
      <th>...</th>
      <th colspan="10" halign="left">pop</th>
    </tr>
    <tr>
      <th></th>
      <th colspan="5" halign="left">max</th>
      <th colspan="5" halign="left">min</th>
      <th>...</th>
      <th colspan="5" halign="left">amax</th>
      <th colspan="5" halign="left">mean</th>
    </tr>
    <tr>
      <th>continent</th>
      <th>Africa</th>
      <th>Americas</th>
      <th>Asia</th>
      <th>Europe</th>
      <th>Oceania</th>
      <th>Africa</th>
      <th>Americas</th>
      <th>Asia</th>
      <th>Europe</th>
      <th>Oceania</th>
      <th>...</th>
      <th>Africa</th>
      <th>Americas</th>
      <th>Asia</th>
      <th>Europe</th>
      <th>Oceania</th>
      <th>Africa</th>
      <th>Americas</th>
      <th>Asia</th>
      <th>Europe</th>
      <th>Oceania</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1952</th>
      <td>Zimbabwe</td>
      <td>Venezuela</td>
      <td>Yemen Rep.</td>
      <td>United Kingdom</td>
      <td>New Zealand</td>
      <td>Algeria</td>
      <td>Argentina</td>
      <td>Afghanistan</td>
      <td>Albania</td>
      <td>Australia</td>
      <td>...</td>
      <td>33119096.0</td>
      <td>157553000.0</td>
      <td>5.562635e+08</td>
      <td>69145952.0</td>
      <td>8691212.0</td>
      <td>4.570010e+06</td>
      <td>13806097.84</td>
      <td>4.228356e+07</td>
      <td>1.393736e+07</td>
      <td>5343003.0</td>
    </tr>
    <tr>
      <th>1957</th>
      <td>Zimbabwe</td>
      <td>Venezuela</td>
      <td>Yemen Rep.</td>
      <td>United Kingdom</td>
      <td>New Zealand</td>
      <td>Algeria</td>
      <td>Argentina</td>
      <td>Afghanistan</td>
      <td>Albania</td>
      <td>Australia</td>
      <td>...</td>
      <td>37173340.0</td>
      <td>171984000.0</td>
      <td>6.374080e+08</td>
      <td>71019069.0</td>
      <td>9712569.0</td>
      <td>5.093033e+06</td>
      <td>15478156.64</td>
      <td>4.735699e+07</td>
      <td>1.459635e+07</td>
      <td>5970988.0</td>
    </tr>
    <tr>
      <th>1962</th>
      <td>Zimbabwe</td>
      <td>Venezuela</td>
      <td>Yemen Rep.</td>
      <td>United Kingdom</td>
      <td>New Zealand</td>
      <td>Algeria</td>
      <td>Argentina</td>
      <td>Afghanistan</td>
      <td>Albania</td>
      <td>Australia</td>
      <td>...</td>
      <td>41871351.0</td>
      <td>186538000.0</td>
      <td>6.657700e+08</td>
      <td>73739117.0</td>
      <td>10794968.0</td>
      <td>5.702247e+06</td>
      <td>17330810.16</td>
      <td>5.140476e+07</td>
      <td>1.534517e+07</td>
      <td>6641759.0</td>
    </tr>
    <tr>
      <th>1967</th>
      <td>Zimbabwe</td>
      <td>Venezuela</td>
      <td>Yemen Rep.</td>
      <td>United Kingdom</td>
      <td>New Zealand</td>
      <td>Algeria</td>
      <td>Argentina</td>
      <td>Afghanistan</td>
      <td>Albania</td>
      <td>Australia</td>
      <td>...</td>
      <td>47287752.0</td>
      <td>198712000.0</td>
      <td>7.545500e+08</td>
      <td>76368453.0</td>
      <td>11872264.0</td>
      <td>6.447875e+06</td>
      <td>19229864.92</td>
      <td>5.774736e+07</td>
      <td>1.603930e+07</td>
      <td>7300207.0</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>Zimbabwe</td>
      <td>Venezuela</td>
      <td>Yemen Rep.</td>
      <td>United Kingdom</td>
      <td>New Zealand</td>
      <td>Algeria</td>
      <td>Argentina</td>
      <td>Afghanistan</td>
      <td>Albania</td>
      <td>Australia</td>
      <td>...</td>
      <td>53740085.0</td>
      <td>209896000.0</td>
      <td>8.620300e+08</td>
      <td>78717088.0</td>
      <td>13177000.0</td>
      <td>7.305376e+06</td>
      <td>21175368.40</td>
      <td>6.518098e+07</td>
      <td>1.668784e+07</td>
      <td>8053050.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 25 columns</p>
</div>
</div>
</div>
</section>
</section>
<section id="wide-to-long" class="level3">
<h3 class="anchored" data-anchor-id="wide-to-long">Wide to Long</h3>
<center>
<img src="images/advanced-pandas/reshaping_melt.png" width="60%" style="margin:auto">
<p style="text-align: center">
I’m meeelllting!
</p>
</center>
<section id="melt" class="level4">
<h4 class="anchored" data-anchor-id="melt">melt</h4>
<p>The opposite of pivoting is melting (…obviously?). This is often used to get data back into long-form. Long-form data will typically have all different possible categories for a single measure in a single column (having a country column instead of Algeria, Albania, Canada… Zimbabwe columns). Long-form data is typically the preferred data style when doing your actual analysis. For example, many of the Seaborns methods we considered for creating stunning visuals assume that the data is in long-form, and is optimized to split out categories internally instead of pulling from multiple different columns.</p>
<p>However, as our data does not always come in the way we want it, we might have to unpivot (melt) our data to get it into long-form first. The <code>melt</code> method is how we attack this in Pandas, and it uses the following arguments:</p>
<ul>
<li><code>id_vars</code>: This is a <strong>required</strong> argument! Column(s) that will be used as identifiers. These are columns that we do <strong>not</strong> wish to unpivot, but leave as is.</li>
<li><code>value_vars</code>: Column(s) to unpivot. If left out, the default is to use all non-id columns.</li>
</ul>
<p>Let’s look at one of the pivoted tables we made earlier, and try to get it back into long form:</p>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>gapminder_year_country.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="52">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>year</th>
      <th>Afghanistan</th>
      <th>Albania</th>
      <th>Algeria</th>
      <th>Angola</th>
      <th>Argentina</th>
      <th>Australia</th>
      <th>Austria</th>
      <th>Bahrain</th>
      <th>Bangladesh</th>
      <th>...</th>
      <th>Uganda</th>
      <th>United Kingdom</th>
      <th>United States</th>
      <th>Uruguay</th>
      <th>Venezuela</th>
      <th>Vietnam</th>
      <th>West Bank and Gaza</th>
      <th>Yemen Rep.</th>
      <th>Zambia</th>
      <th>Zimbabwe</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1952</td>
      <td>8425333.0</td>
      <td>1282697.0</td>
      <td>9279525.0</td>
      <td>4232095.0</td>
      <td>17876956.0</td>
      <td>8691212.0</td>
      <td>6927772.0</td>
      <td>120447.0</td>
      <td>46886859.0</td>
      <td>...</td>
      <td>5824797.0</td>
      <td>50430000.0</td>
      <td>157553000.0</td>
      <td>2252965.0</td>
      <td>5439568.0</td>
      <td>26246839.0</td>
      <td>1030585.0</td>
      <td>4963829.0</td>
      <td>2672000.0</td>
      <td>3080907.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1957</td>
      <td>9240934.0</td>
      <td>1476505.0</td>
      <td>10270856.0</td>
      <td>4561361.0</td>
      <td>19610538.0</td>
      <td>9712569.0</td>
      <td>6965860.0</td>
      <td>138655.0</td>
      <td>51365468.0</td>
      <td>...</td>
      <td>6675501.0</td>
      <td>51430000.0</td>
      <td>171984000.0</td>
      <td>2424959.0</td>
      <td>6702668.0</td>
      <td>28998543.0</td>
      <td>1070439.0</td>
      <td>5498090.0</td>
      <td>3016000.0</td>
      <td>3646340.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1962</td>
      <td>10267083.0</td>
      <td>1728137.0</td>
      <td>11000948.0</td>
      <td>4826015.0</td>
      <td>21283783.0</td>
      <td>10794968.0</td>
      <td>7129864.0</td>
      <td>171863.0</td>
      <td>56839289.0</td>
      <td>...</td>
      <td>7688797.0</td>
      <td>53292000.0</td>
      <td>186538000.0</td>
      <td>2598466.0</td>
      <td>8143375.0</td>
      <td>33796140.0</td>
      <td>1133134.0</td>
      <td>6120081.0</td>
      <td>3421000.0</td>
      <td>4277736.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1967</td>
      <td>11537966.0</td>
      <td>1984060.0</td>
      <td>12760499.0</td>
      <td>5247469.0</td>
      <td>22934225.0</td>
      <td>11872264.0</td>
      <td>7376998.0</td>
      <td>202182.0</td>
      <td>62821884.0</td>
      <td>...</td>
      <td>8900294.0</td>
      <td>54959000.0</td>
      <td>198712000.0</td>
      <td>2748579.0</td>
      <td>9709552.0</td>
      <td>39463910.0</td>
      <td>1142636.0</td>
      <td>6740785.0</td>
      <td>3900000.0</td>
      <td>4995432.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1972</td>
      <td>13079460.0</td>
      <td>2263554.0</td>
      <td>14760787.0</td>
      <td>5894858.0</td>
      <td>24779799.0</td>
      <td>13177000.0</td>
      <td>7544201.0</td>
      <td>230800.0</td>
      <td>70759295.0</td>
      <td>...</td>
      <td>10190285.0</td>
      <td>56079000.0</td>
      <td>209896000.0</td>
      <td>2829526.0</td>
      <td>11515649.0</td>
      <td>44655014.0</td>
      <td>1089572.0</td>
      <td>7407075.0</td>
      <td>4506497.0</td>
      <td>5861135.0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 143 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="53">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>gapminder_year_country.melt(id_vars<span class="op">=</span><span class="st">'year'</span>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="53">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>year</th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1952</td>
      <td>Afghanistan</td>
      <td>8425333.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1957</td>
      <td>Afghanistan</td>
      <td>9240934.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1962</td>
      <td>Afghanistan</td>
      <td>10267083.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1967</td>
      <td>Afghanistan</td>
      <td>11537966.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1972</td>
      <td>Afghanistan</td>
      <td>13079460.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>If we wish to only keep a subset of the countries, we can do that too. We can also change the name of the resultant <code>variable</code> and <code>value</code> columns:</p>
<div class="cell" data-execution_count="54">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>gapminder_year_country.melt(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    value_vars <span class="op">=</span> [<span class="st">'Albania'</span>, <span class="st">'Canada'</span>, <span class="st">'Zimbabwe'</span>],</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>    var_name <span class="op">=</span> <span class="st">'country'</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>    value_name <span class="op">=</span> <span class="st">'pop'</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>).head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="54">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>year</th>
      <th>country</th>
      <th>pop</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1952</td>
      <td>Albania</td>
      <td>1282697.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1957</td>
      <td>Albania</td>
      <td>1476505.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1962</td>
      <td>Albania</td>
      <td>1728137.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1967</td>
      <td>Albania</td>
      <td>1984060.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1972</td>
      <td>Albania</td>
      <td>2263554.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Overmelting!
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>When melting our data, we want to be careful, and not ‘overmelt’! Think back to the original gapminder dataset:</p>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>gapminder.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="55">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>pop</th>
      <th>continent</th>
      <th>lifeExp</th>
      <th>gdpPercap</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1952</td>
      <td>8425333.0</td>
      <td>Asia</td>
      <td>28.801</td>
      <td>779.445314</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1957</td>
      <td>9240934.0</td>
      <td>Asia</td>
      <td>30.332</td>
      <td>820.853030</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>1962</td>
      <td>10267083.0</td>
      <td>Asia</td>
      <td>31.997</td>
      <td>853.100710</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>1967</td>
      <td>11537966.0</td>
      <td>Asia</td>
      <td>34.020</td>
      <td>836.197138</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>1972</td>
      <td>13079460.0</td>
      <td>Asia</td>
      <td>36.088</td>
      <td>739.981106</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Would the following melt make sense?</p>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>gapminder.melt(</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    id_vars<span class="op">=</span>[<span class="st">'country'</span>, <span class="st">'year'</span>, <span class="st">'continent'</span>]</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="56">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>country</th>
      <th>year</th>
      <th>continent</th>
      <th>variable</th>
      <th>value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Afghanistan</td>
      <td>1952</td>
      <td>Asia</td>
      <td>pop</td>
      <td>8.425333e+06</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Afghanistan</td>
      <td>1957</td>
      <td>Asia</td>
      <td>pop</td>
      <td>9.240934e+06</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Afghanistan</td>
      <td>1962</td>
      <td>Asia</td>
      <td>pop</td>
      <td>1.026708e+07</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Afghanistan</td>
      <td>1967</td>
      <td>Asia</td>
      <td>pop</td>
      <td>1.153797e+07</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Afghanistan</td>
      <td>1972</td>
      <td>Asia</td>
      <td>pop</td>
      <td>1.307946e+07</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>5107</th>
      <td>Zimbabwe</td>
      <td>1987</td>
      <td>Africa</td>
      <td>gdpPercap</td>
      <td>7.061573e+02</td>
    </tr>
    <tr>
      <th>5108</th>
      <td>Zimbabwe</td>
      <td>1992</td>
      <td>Africa</td>
      <td>gdpPercap</td>
      <td>6.934208e+02</td>
    </tr>
    <tr>
      <th>5109</th>
      <td>Zimbabwe</td>
      <td>1997</td>
      <td>Africa</td>
      <td>gdpPercap</td>
      <td>7.924500e+02</td>
    </tr>
    <tr>
      <th>5110</th>
      <td>Zimbabwe</td>
      <td>2002</td>
      <td>Africa</td>
      <td>gdpPercap</td>
      <td>6.720386e+02</td>
    </tr>
    <tr>
      <th>5111</th>
      <td>Zimbabwe</td>
      <td>2007</td>
      <td>Africa</td>
      <td>gdpPercap</td>
      <td>4.697093e+02</td>
    </tr>
  </tbody>
</table>
<p>5112 rows × 5 columns</p>
</div>
</div>
</div>
<p>Probably not. Having the population, GDP, and life expectancy all in the same column might lead to confusing results. As a general rule of thumb, including multiple unique measures that have different units (population is measured in number of people, life expectancy in years, and GDP per capita in dollars per person) in the same column is typically avoided. Another way to think of it is this: if I take the average of the entire column, will that actually make sense? Try not to melt further than necessary! Striking a balance between machine-preferred (entirely long-form) and human-preferred (wide-form) is an important and useful skill when creating scripts to analyse our datasets!</p>
</div>
</div>
</div>
<p>These examples only touch the surface of methods to reshape our data. To explore even further, Pandas provides a <a href="https://pandas.pydata.org/pandas-docs/stable/user_guide/reshaping.html">user guide to reshaping.</a> Check this out for even more reshaping functionality!</p>
</section>
</section>
<section id="challenge-4" class="level3">
<h3 class="anchored" data-anchor-id="challenge-4">Challenge 4</h3>
<div class="callout-warning callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge 4
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a pivot table that counts the number of countries in each continent that has a population greater than 1,000,000 in any given year.</p>
</div>
</div>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution to Challenge 4
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>First, let’s demonstrate this using the methods we’ve learned about to reshape our data. We can create this aggregated pivot table using the <code>pivot_table</code> method, and supplying ‘count’ to the <code>aggfunc</code> method.</p>
<div class="cell" data-execution_count="57">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>gapminder[gapminder[<span class="st">'pop'</span>]<span class="op">&gt;</span><span class="dv">1_000_000</span>].pivot_table(</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'year'</span>,</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span><span class="st">'continent'</span>,</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'country'</span>,</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>    aggfunc<span class="op">=</span><span class="st">'count'</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="57">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>continent</th>
      <th>Africa</th>
      <th>Americas</th>
      <th>Asia</th>
      <th>Europe</th>
      <th>Oceania</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1952</th>
      <td>37</td>
      <td>22</td>
      <td>28</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1957</th>
      <td>37</td>
      <td>24</td>
      <td>28</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1962</th>
      <td>39</td>
      <td>24</td>
      <td>29</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1967</th>
      <td>39</td>
      <td>24</td>
      <td>30</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>40</td>
      <td>24</td>
      <td>30</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1977</th>
      <td>40</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1982</th>
      <td>41</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1987</th>
      <td>43</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1992</th>
      <td>45</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1997</th>
      <td>47</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>47</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>47</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>This type of table is commonly referred to as a <strong>crosstable</strong>: it gives us the frequency of occurences of items under different groupings. Because it is such a widely used table, it was given its own special method in Pandas: <code>crosstab</code>. Basic functionality is to supply two Series that we wish to cross-tabulate to the method, and let it do all the work. Note that this is a Pandas specific method, not a dataframe specific method!</p>
<div class="cell" data-execution_count="58">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>gapminder_filtered <span class="op">=</span> gapminder[gapminder[<span class="st">'pop'</span>]<span class="op">&gt;</span><span class="dv">1_000_000</span>]</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>pd.crosstab(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>gapminder_filtered[<span class="st">'year'</span>],</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    columns<span class="op">=</span>gapminder_filtered[<span class="st">'continent'</span>]</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="58">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th>continent</th>
      <th>Africa</th>
      <th>Americas</th>
      <th>Asia</th>
      <th>Europe</th>
      <th>Oceania</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1952</th>
      <td>37</td>
      <td>22</td>
      <td>28</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1957</th>
      <td>37</td>
      <td>24</td>
      <td>28</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1962</th>
      <td>39</td>
      <td>24</td>
      <td>29</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1967</th>
      <td>39</td>
      <td>24</td>
      <td>30</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1972</th>
      <td>40</td>
      <td>24</td>
      <td>30</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1977</th>
      <td>40</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1982</th>
      <td>41</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1987</th>
      <td>43</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1992</th>
      <td>45</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1997</th>
      <td>47</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>47</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>47</td>
      <td>25</td>
      <td>32</td>
      <td>28</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./31_bcdata.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Introduction to bcdata</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./33_create_reports.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Creating Reports</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Introduction to Data Science using Python was written by <br> Lindsay Forestell and Stuart Hemerling</div>   
      <div class="nav-footer-center">
        <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="./license.qmd">License</a>
  </li>  
    <li class="nav-item">
    <a class="nav-link" href="https://bcgov.github.io/ds-intro-to-python/index.html">Python for Data Science Course</a>
  </li>  
</ul>
      </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>



</body></html>